(()=>{var o={961:(e,t,s)=>{f=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};var f,o,r,n,i,a=i={compressToBase64:function(e){if(null==e)return"";var t=i._compress(e,6,function(e){return o.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,function(e){return c(o,t.charAt(e))})},compressToUTF16:function(e){return null==e?"":i._compress(e,15,function(e){return f(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:i._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),s=new Uint8Array(2*t.length),o=0,r=t.length;o<r;o++){var n=t.charCodeAt(o);s[2*o]=n>>>8,s[2*o+1]=n%256}return s},decompressFromUint8Array:function(e){if(null==e)return i.decompress(e);for(var t=new Array(e.length/2),s=0,o=t.length;s<o;s++)t[s]=256*e[2*s]+e[2*s+1];var r=[];return t.forEach(function(e){r.push(f(e))}),i.decompress(r.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return r.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,function(e){return c(r,t.charAt(e))}))},compress:function(e){return i._compress(e,16,function(e){return f(e)})},_compress:function(e,t,s){if(null==e)return"";for(var o,r,n,i,a={},c={},l="",u=2,h=3,d=2,p=[],g=0,v=0,b=0;b<e.length;b+=1)if(n=e.charAt(b),Object.prototype.hasOwnProperty.call(a,n)||(a[n]=h++,c[n]=!0),i=l+n,Object.prototype.hasOwnProperty.call(a,i))l=i;else{if(Object.prototype.hasOwnProperty.call(c,l)){if(l.charCodeAt(0)<256){for(o=0;o<d;o++)g<<=1,v==t-1?(v=0,p.push(s(g)),g=0):v++;for(r=l.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1}else{for(r=1,o=0;o<d;o++)g=g<<1|r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r=0;for(r=l.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1}0==--u&&(u=Math.pow(2,d),d++),delete c[l]}else for(r=a[l],o=0;o<d;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1;0==--u&&(u=Math.pow(2,d),d++),a[i]=h++,l=String(n)}if(""!==l){if(Object.prototype.hasOwnProperty.call(c,l)){if(l.charCodeAt(0)<256){for(o=0;o<d;o++)g<<=1,v==t-1?(v=0,p.push(s(g)),g=0):v++;for(r=l.charCodeAt(0),o=0;o<8;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1}else{for(r=1,o=0;o<d;o++)g=g<<1|r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r=0;for(r=l.charCodeAt(0),o=0;o<16;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1}0==--u&&(u=Math.pow(2,d),d++),delete c[l]}else for(r=a[l],o=0;o<d;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1;0==--u&&(u=Math.pow(2,d),d++)}for(r=2,o=0;o<d;o++)g=g<<1|1&r,v==t-1?(v=0,p.push(s(g)),g=0):v++,r>>=1;for(;;){if(g<<=1,v==t-1){p.push(s(g));break}v++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:i._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,t,s){for(var o,r,n,i,a,c,l=[],u=4,h=4,d=3,p="",g=[],v={val:s(0),position:t,index:1},b=0;b<3;b+=1)l[b]=b;for(r=0,i=Math.pow(2,2),a=1;a!=i;)n=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=s(v.index++)),r|=(0<n?1:0)*a,a<<=1;switch(r){case 0:for(r=0,i=Math.pow(2,8),a=1;a!=i;)n=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=s(v.index++)),r|=(0<n?1:0)*a,a<<=1;c=f(r);break;case 1:for(r=0,i=Math.pow(2,16),a=1;a!=i;)n=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=s(v.index++)),r|=(0<n?1:0)*a,a<<=1;c=f(r);break;case 2:return""}for(o=l[3]=c,g.push(c);;){if(e<v.index)return"";for(r=0,i=Math.pow(2,d),a=1;a!=i;)n=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=s(v.index++)),r|=(0<n?1:0)*a,a<<=1;switch(c=r){case 0:for(r=0,i=Math.pow(2,8),a=1;a!=i;)n=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=s(v.index++)),r|=(0<n?1:0)*a,a<<=1;l[h++]=f(r),c=h-1,u--;break;case 1:for(r=0,i=Math.pow(2,16),a=1;a!=i;)n=v.val&v.position,v.position>>=1,0==v.position&&(v.position=t,v.val=s(v.index++)),r|=(0<n?1:0)*a,a<<=1;l[h++]=f(r),c=h-1,u--;break;case 2:return g.join("")}if(0==u&&(u=Math.pow(2,d),d++),l[c])p=l[c];else{if(c!==h)return null;p=o+o.charAt(0)}g.push(p),l[h++]=o+p.charAt(0),o=p,0==--u&&(u=Math.pow(2,d),d++)}}};function c(e,t){if(!n[e]){n[e]={};for(var s=0;s<e.length;s++)n[e][e.charAt(s)]=s}return n[e][t]}void 0!==(s=function(){return a}.call(t,s,t,e))&&(e.exports=s)},607:function(e,t,s){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,s,o){void 0===o&&(o=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,o,r)}:function(e,t,s,o){e[o=void 0===o?s:o]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||o(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(s(397),t)},850:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.ByteBoost=r.BASE_API_URL=void 0;var s=t(356),o=t(230),n=t(258),i=t(81);const a=t(429);var c=t(682),l=t(882);const u=t(601),h=(r.BASE_API_URL="https://external.api.byteboost.io",{DEBUG:"#5075DA",INFO:"#50DA7C",ERROR:"#DA6550",WARN:"#DAB250"}),d="__byteboost.io__persistant_data",p=d+"_m",g=[s.EventBus,n.RequestModule,o.Logger,i.ErrorModule,c.Core,l.Pinger];r.ByteBoost=class{modules;performance;navigator;initializedAt=0;apiKey;obfuscateLevel;doFullByteBoostRestart;constructor(e){this.info("starting"),this.obfuscateLevel=e.obfuscateLevel,this.doFullByteBoostRestart=e.startByteboost,this.navigator=window.navigator,this.performance=window.performance||self.performance,this.apiKey=e.apiKey;let t=this.getPersistantData();!1===t&&(t={}),this.modules={};for(var s of g){s=new s;t.hasOwnProperty(s.namespace)?s.unpack(t[s.namespace]):s.onBuildNeeded(),this.modules[s.namespace]={namespace:s.namespace,module:s}}window.addEventListener("beforeunload",v)}initializeModules(){for(var e in this.debug("initializing modules"),this.modules)"eventBus"!==e&&this.modules[e].module.bindEventBus(this.getModule("eventBus")),this.modules[e].module.boot();this.initializedAt=Date.now()}getModule(e){if(this.modules[e])return this.modules[e].module}getApiKey(){return this.apiKey}debug(...e){console.log("%c[byteboost]","color:"+h.DEBUG+";font-weight:bold;",...e)}info(...e){console.log("%c[byteboost]","color:"+h.INFO+";font-weight:bold;",...e)}warn(...e){console.log("%c[byteboost]","color:"+h.WARN+";font-weight:bold;",...e)}error(...e){console.log("%c[byteboost]","color:"+h.ERROR+";font-weight:bold;",...e)}async compilePersistantData(){var e,t={};for(e in this.modules){var s=await this.modules[e].module.pack();t[e]=s}return t}async purge(){await this.cleanup(),localStorage.removeItem(d),localStorage.removeItem(p),this.doFullByteBoostRestart()}async forceReload(){await this.cleanup(),this.doFullByteBoostRestart()}getPersistantData(){try{var e=JSON.parse((0,u.uncompressString)(localStorage.getItem(d))),t=JSON.parse(localStorage.getItem(p)),s=Date.now(),o=(0,a.uncompressJSON)(e,t);if(this.debug("Uncompression took:",Date.now()-s,"ms"),o)return o;throw"unable to compress"}catch(e){return!1}}async cleanup(){for(var e in this.debug("cleaning up"),this.modules){e=this.modules[e].module;e.cleanup(),"isDataModule"in e&&e.forceSend()}var t=await this.compilePersistantData(),s=Date.now(),[t,o]=(0,a.compressJSON)(t),s=(this.debug("Compression took:",Date.now()-s,"ms"),JSON.stringify(t)),t=JSON.stringify(o),s=(0,u.compressString)(s);try{localStorage.setItem(d,s),localStorage.setItem(p,t)}catch(e){this.error("Unable to save data to local storage",e)}window.removeEventListener("beforeunload",v),this.info("terminated"),this.info("informing backend"),fetch(r.BASE_API_URL+"/v1beta/session/kill",{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey??""}}),window._byteboost&&delete window._byteboost}getObfuscateLevel(){return this.obfuscateLevel}};const v=async()=>{await window._byteboost.cleanup()}},397:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDev=t.wrapWindow=void 0;const o=s(850),r=s(252),n=s(924);t.wrapWindow=()=>{if("undefined"!=typeof window&&!window._byteboost&&!window._startingByteboost){const t=async()=>{await(0,n.setupPersistantWorkers)();var e=await(0,r.preflightChecks)();!1!==e&&e?(console.log("Preflight succeded!"),window._byteboost=new o.ByteBoost({apiKey:window.byteboostKey,startByteboost:t,obfuscateLevel:e.obfuscateLevel}),window._byteboost.initializeModules()):(console.log("Preflight failed"),await(0,n.killPersistantWorkers)())};try{console.log("starting byteboost"),t()}catch(e){}}},(0,t.wrapWindow)();t.isDev=()=>!0},601:function(e,t,s){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.uncompressString=t.compressString=t.findCircular=t.removeCircular=void 0;const r=o(s(961));t.removeCircular=function(e){const o=new Map,r=e=>{if(o.set(e,!0),e)for(var[t,s]of Object.entries(e))"object"==typeof s&&(o.has(s)?e[t]="[byteboost-3200] circular reference":r(s))};return r(e),e},t.findCircular=function(e){let o=!1;const r=new Map,n=e=>{if(r.set(e,!0),!o&&e)for(var[t,s]of Object.entries(e)){if(o)return;if("object"==typeof s){if(r.has(s)){o=!0;break}n(s)}}};return n(e),o};t.compressString=e=>null==e?"":r.default.compress(e);t.uncompressString=e=>null==e?"":r.default.decompress(e)},682:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Core=void 0;const o=s(765);var r=s(134);const n=s(580),i=s(924),a=s(601),c=s(863);class l extends r.BaseDataModule{networkTracker;screenshotWorker;lastScreenshotTime=-1;_obfuscateLevel=-1;lastMetaScreen={width:0,height:0};constructor(){super("core")}get obfuscateLevel(){if(-1===this._obfuscateLevel)throw new Error("Obfuscate level is unset");return this._obfuscateLevel}handlePath(){let e=window.location.pathname;var t,s;0===e.length&&(e="/"),this.state.currentPath.pathname!==e&&(t=Date.now(),s=(0,n.cloneObject)(this.state.currentPath),this.state.currentPath.pathname=e,this.byteboost.debug("path changed!",this.state.currentPath),this.captureScreenshot(!0),this.eventBus.dispatch(this.namespace,"pathUpdate",{from:s.pathname,to:this.state.currentPath.pathname,when:t}))}getFormattedPath(){return this.state.currentPath.pathname}onPoll(){this.handlePath(),this.handleWindowSize(),this.networkTracker.emit("requests:get")}gotClick(e){this.state.clicks.push(e),this.byteboost.debug("new click state",this.state.clicks)}gatherRelevantElementData(e,t=0){return{innerHTML:(0,a.compressString)(e.innerHTML),outerHTML:(0,a.compressString)(e?.outerHTML),scrollHeight:e?.scrollHeight,scrollLeft:e?.scrollLeft,scrollTop:e?.scrollTop,scrollWidth:e?.scrollWidth,scrollLeftMax:e?.scrollLeftMax,scrollTopMax:e?.scrollTopMax,clientHeight:e?.clientHeight,clientLeft:e?.clientLeft,clientTop:e?.clientTop,clientWidth:e?.clientWidth,attrId:e.getAttribute("id")??void 0,attrClassName:e.getAttribute("class")??void 0,attrStyle:e.getAttribute("style")??void 0}}getAppropriateClickEvent(e,t){var s=e.target||e.srcElement,e={...this.getMousePos(e),when:t||Date.now(),count:1};if(!s)return e;this.byteboost.debug(s);t=s;return{...e,element:this.gatherRelevantElementData(t),where:this.getFormattedPath()}}boundedClickListener(e){this.byteboost.debug("got click event!");var t=Date.now(),e=(this.captureScreenshot(),this.getAppropriateClickEvent(e,t));this.eventBus.dispatch("core","click",e)}async captureScreenshot(e){var t,s=Date.now();s-5e3<this.lastScreenshotTime&&!0!==e||(this.lastScreenshotTime=s,this.byteboost.debug("capturing screenshot"),e=(new XMLSerializer).serializeToString(document),t=new TextEncoder,this.screenshotWorker.emit("screenshot:parse",{document:t.encode(e),when:s}))}handleRequests(e){for(const s of e.requests){var t=(0,c.requestObfuscator)(s,this.obfuscateLevel);0===t.referrer.length&&(t.referrer=window.location.toString()),t.method=t.method.toLowerCase(),this.state.requests.push({request:t})}}handleWindowSize(){var e={width:window.innerWidth,height:window.innerHeight};this.lastMetaScreen&&this.lastMetaScreen.height===e.height&&this.lastMetaScreen.width===e.width||(this.lastMetaScreen=e,this.emit("metaUpdate",{when:Date.now(),screen:e}))}boot(){var e=(0,i.getPersistantWorker)("network-tracker");this._obfuscateLevel=this.byteboost.getObfuscateLevel(),e&&(this.networkTracker=e,this.networkTracker.on("requests:get",e=>{0!==e.length&&this.eventBus.dispatch("core","requests",{requests:e})})),this.screenshotWorker=new o.WebWorker("screenshot-parser"),this.screenshotWorker.on("screenshot:parsed",e=>{console.log("got screenshot:parsed",e)}),this.receivePolls(),this.handleWindowSize(),this.on("metaUpdate",e=>{this.state.metaUpdates.push(e)}),this.eventBus.listen("core","requests",e=>{this.handleRequests(e)}),this.eventBus.listen("core","screenshot:captured",e=>{this.state.screenshots.push(e)}),this.eventBus.listen("core","click",e=>{this.gotClick(e)}),this.eventBus.listen(this.namespace,"pathUpdate",e=>{this.state.navigations.push(e)}),document.addEventListener("click",u,{capture:!0}),this.doSync()}formatSyncData(){var e;return 0===this.state.navigations.length&&0===this.state.screenshots.length&&0===this.state.clicks.length&&0===this.state.requests.length&&0===this.state.metaUpdates.length?{_empty:!0}:((e=(0,n.cloneObject)(this.state)).requests=e.requests.map(e=>e.request),this.byteboost.debug("cloned state",e,"current",this.state),e.currentPath=this.state.currentPath.pathname,e)}onSync(e){e.response.success?(this.state.navigations=this.eventBus.cleanSyncedData(this.state.navigations,e),this.state.screenshots=this.eventBus.cleanSyncedData(this.state.screenshots,e),this.state.clicks=this.eventBus.cleanSyncedData(this.state.clicks,e),this.state.requests=this.eventBus.cleanSyncedData(this.state.requests,e),this.state.metaUpdates=this.eventBus.cleanSyncedData(this.state.metaUpdates,e)):this.byteboost.error("Unable to sync core module.")}cleanup(){console.log("removing click listener"),document.removeEventListener("click",u)}getMousePos(e){var t,s;let o=e?.pageX??0,r=e?.pageY??0;return null==e.pageX&&null!=e.clientX&&(t=(s=e.target&&e.target.ownerDocument||document).documentElement,s=s.body,o=e.clientX+(t&&t.scrollLeft||s&&s.scrollLeft||0)-(t&&t.clientLeft||s&&s.clientLeft||0),r=e.clientY+(t&&t.scrollTop||s&&s.scrollTop||0)-(t&&t.clientTop||s&&s.clientTop||0)),{x:o??-1,y:r??-1}}build(){return{navigations:[],currentPath:{pathname:"/"},clicks:[],screenshots:[],requests:[],metaUpdates:[]}}}t.Core=l;const u=e=>{var t;window._byteboost&&(t=window._byteboost.getModule("core"))&&t.boundedClickListener(e)}},863:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.requestObfuscator=void 0;const o=s(580),r=s(720);var s=["a-im","accept","accept-charset","accept-datetime","accept-encoding","accept-language","access-control-request-method","cache-control","connection","content-encoding","content-type","date","expect","host","if-modified-since","if-unmodified-since","max-forwards","origin","pragma","prefer","range","referer","te","trailer","transfer-encoding","user-agent","upgrade","via","warning","upgrade-insecure-requests","x-requested-with","dnt","x-forwarded-host","x-forwarded-proto","front-end-https","x-http-method-override","proxy-connection","save-data","sec-gpc","accept-ch","access-control-allow-credentials","access-control-expose-headers","access-control-max-age","access-control-allow-methods","access-control-allow-headers","access-control-allow-origin","accept-patch","accept-ranges","age","allow","alt-svc","cache-control","connection","content-disposition","content-encoding","content-language","content-length","content-location","content-range","content-type","date","delta-base","expires","im","last-modified","link","location","pragma","preference-applied","proxy-authenticate","public-key-pins","retry-after","server","strict-transport-security","trailer","transfer-encoding","tk","upgrade","vary","via","warning","www-authenticate","x-frame-options","x-content-security-policy","x-webkit-csp","content-security-policy","expect-ct","nel","permissions-policy","refresh","report-to","status","timing-allow-origin","x-content-duration","x-content-type-options","x-powered-by","x-redirect-by","x-request-id","x-correlation-id","x-ua-compatible","x-xss-protection"],n=["content-length","forwarded",...s],i=["access-control-request-headers","content-md5","from","http2-settings","if-match","if-none-match","if-range","proxy-authorization","x-forwarded-for","x-att-deviceid","x-wap-profile","x-uidh","x-correlation-id","correlation-id","x-request-id","content-md5","etag","p3p",...n];const a={[r.ObfuscateLevel.HIGH]:s,[r.ObfuscateLevel.MEDIUM]:n,[r.ObfuscateLevel.LOW]:i},c=(e,t)=>{var s={};for(const o in e)a[t].includes(o)&&(s[o]=e[o]);return s};t.requestObfuscator=(t,s)=>{t=(0,o.cloneObject)(t);if(t.requestHeaders=c(t.requestHeaders,s),t.responseHeaders=c(t.responseHeaders,s),t.url.includes("?")&&s!==r.ObfuscateLevel.LOW){let e=t.url.split("?")[1];e=s===r.ObfuscateLevel.HIGH?"[QUERY_STRING_OBFUSCATED]":e.split("&").map(e=>{var[e,t]=e.split("=");return e&&t?e+"=[SOME_OBFUSCATED_VALUE]":"[NULL]"}).join("&"),t.url=t.url.substring(0,t.url.indexOf("?"))+("?"+e)}return t}},720:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObfuscateLevel=void 0,t.ObfuscateLevel={HIGH:2,2:"HIGH",MEDIUM:1,1:"MEDIUM",LOW:0,0:"LOW"}},81:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorModule=void 0;var o=s(134);const r=s(580);class n extends o.BaseDataModule{core;constructor(){super("errors")}processError(e){var t={when:Date.now(),message:"",where:this.core.getFormattedPath()};"message"in e.message&&"stack"in e.message?(t.message=e.message.message,t.stack=e.message.stack):t.message=e.message,this.core.captureScreenshot(!0),this.eventBus.dispatch(this.namespace,"onError",t)}handledRejectionError(e){console.log("got handled rejection error!")}unhandledRejectionError(e){console.log("catched error"),this.processError({message:e.reason})}boot(){var e=this.byteboost.getModule("core");if(!e)throw new Error("Unable to get core module!");this.core=e,window.addEventListener("rejectionhandled ",e=>{this.handledRejectionError(e)}),window.addEventListener("unhandledrejection",e=>{this.unhandledRejectionError(e)}),this.eventBus.listen(this.namespace,"onError",e=>{this.state.errors.push(e)}),this.doSync()}formatSyncData(){return 0===this.state.errors.length?{_empty:!0}:(0,r.cloneObject)(this.state)}onSync(e){e.response.success?this.state.errors=this.eventBus.cleanSyncedData(this.state.errors,e):this.byteboost.error("Unable to sync error module")}build(){return{errors:[]}}onOutsideError(){}}t.ErrorModule=n},356:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventBus=t.ByteEvent=void 0;const o=s(580);var r=s(134);const n=s(397),i=s(601);var a=s(750);const c=e=>`${e}|${Date.now()}|`+(t=>{let s="";var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=o.length;for(let e=0;e<t;e++)s+=o.charAt(Math.floor(Math.random()*r));return s})(8);class l{id;payload;eventId;_meta={dispatched:-1};delay;when;priority=0;constructor(e,t,s,o){e=e+":"+t;this.when=Date.now(),this.id=e,this.payload=s,this.eventId=c(e),this.delay={waited:0,toWait:0,lastPoll:0},o&&(this.priority=o)}isValid(){return!!(this.id&&this.payload&&this.delay&&this.eventId)}setPayload(e){this.payload=e}sharpen(e){return this.id=e.id,this.eventId=e.eventId,this.payload=e.payload,this.delay=e.delay,this._meta=e._meta,this.priority=e.priority,this.when=e.when,this}flatten(){return{id:this.id,payload:(0,o.cloneObject)(this.payload),delay:this.delay,_meta:this._meta,eventId:this.eventId,priority:this.priority,when:this.when}}wait(e){return this.delay.lastPoll=Date.now(),this.delay.toWait=e,this}copy(){return new l("","",{}).sharpen(this.flatten())}}t.ByteEvent=l;class u extends r.BaseDataModule{polling=!1;middlewares={before:[h,...a.beforeMiddlewares],after:[]};modulesToPoll=[];_poll;_garbage={events:[],eventsStr:[]};constructor(){super("eventBus"),this._poll={current:{id:0,timeout:1e3}},this.syncPathName=this.namespace.toLowerCase()}toByteId(e,t){return e+":"+t}dispatch(e,t,s){this.dispatchEvent(new l(e,t,s))}dispatchEvent(e){try{if((0,n.isDev)()&&"object"==typeof e.payload)if((0,i.findCircular)(e.payload))return void this.byteboost.error("unable to dispatch event. payload has circular properties -> new byte event:",e);var t=e.copy();t.payload._eventId=t.eventId,this.state.eventQueue.push(t)}catch(e){this.byteboost.error("Error on dispatch",e)}}listen(e,t,s){null!=this.state.eventListeners&&(this.state.eventListeners.hasOwnProperty(e=e+":"+t)?this.state.eventListeners[e].push(s):this.state.eventListeners[e]=[s])}getNextEvent(){return this.state.eventQueue[0]}removeNextEvent(){return this.state.eventQueue.shift()}before(e){let t=!0;for(var s of this.middlewares.before)if(!1===s(e)){t=!1;break}return t}addModulePolling(e){this.modulesToPoll.push(e)}enginePoll(){for(var e of this.modulesToPoll)e.onPoll()}after(e){}async sleep(t){await new Promise(e=>{setTimeout(()=>{e()},t)})}runEventContext(){let o=this.state.eventQueue.slice();const e=()=>{if(0===o.length)return null;let t=o[o.length-1],s=o.length-1;for(let e=0;e<o.length;e++)o[e].priority>t.priority&&(t=o[e],s=e);return o.splice(s,1),this.before(t)?t:e()};let t=e();var s;t&&(-1===(s=this.state.eventQueue.findIndex(e=>e.eventId===t.eventId))?this.byteboost.error("Unable to find event in event queue",t):(this.state.eventQueue.splice(s,1),this.state.processingEvents.push(t)))}dispatchNextProcessedEvent(){if(0===this.state.processingEvents.length)return null;var e,t=this.state.processingEvents[0];if(!(t.id in this.state.eventListeners)||0===this.state.eventListeners[t.id].length)return this.byteboost.warn("no listeners found for event:",t),null;this.byteboost.debug("dispatching event:",t);for(e of this.state.eventListeners[t.id])e(t.payload);return t._meta={dispatched:Date.now()},this.isGarbageEvent(t)||this.state.handledEvents.push(t.flatten()),this.state.processingEvents.shift(),t}async poll(){var e;await this.sleep(this._poll.current.timeout),this.polling&&(this._poll.current.id++,null==this.state.eventListeners?(this.byteboost.error("[EventBus] No event listeners. Stopping polling"),this.polling=!1):(null!==(e=this.dispatchNextProcessedEvent())&&this.after(e),this.runEventContext(),this.enginePoll(),this.poll()))}declareGarbage(t,s){this._garbage.events.find(e=>t===e.app&&s===e.id)||(this._garbage.events.push({app:t,id:s}),this._garbage.eventsStr.push(t+":"+s))}formatSyncData(){return{handledEvents:(0,i.removeCircular)(this.state.handledEvents)}}onSync(e){if(e.response.success){const t=e.data._syncRequestedAt;this.state.handledEvents=this.state.handledEvents.filter(e=>e._meta.dispatched>t)}else this.byteboost.error("Unable to sync eventBus module.")}removeHandledEvents(t){this.state.handledEvents=this.state.handledEvents.filter(e=>!t.includes(e.eventId))}getHandledEvent(t){if(t)return this.state.handledEvents.find(e=>e.eventId===t)}cleanSyncedData(e,s){if(0===e.length)return e;let o=[];e=e.filter(e=>{var t,e=this.getHandledEvent(e._eventId);return!!e&&((t=!(e._meta.dispatched>s.data._syncRequestedAt))&&o.push(e.eventId),!t)});return this.removeHandledEvents(o),e}boot(){this.polling=!0,this.declareGarbage("request","sync"),this.poll()}cleanup(){this.polling=!1}isGarbageEvent(e){return this._garbage.eventsStr.includes(e.id)}removeGarbageEvents(e){return e.filter(e=>{return!this._garbage.eventsStr.includes(e.id)})}packEventList(e){e=e.slice(),e=(0,i.removeCircular)((0,o.cloneObject)(e));return this.removeGarbageEvents(e)}unpackEventList(e){return e&&0!==e.length?e.map(e=>new l("","",{}).sharpen(e)):[]}async pack(){var e=this.packEventList(this.state.eventQueue),t=this.packEventList(this.state.processingEvents),s=this.state.handledEvents.slice(),s=(0,i.removeCircular)((0,o.cloneObject)(s));return{...this.state,eventListeners:null,eventQueue:e,processingEvents:t,handledEvents:s}}unpack(e){e.eventQueue=this.unpackEventList(e.eventQueue),e.processingEvents=this.unpackEventList(e.processingEvents),e.eventListeners={},super.unpack(e)}build(){return{eventQueue:[],processingEvents:[],eventListeners:{},lastEventId:"",handledEvents:[]}}}t.EventBus=u;const h=e=>{if(!e.isValid()){var t=window._byteboost.getModule("eventBus");if(!t)return window._byteboost.error("Unable to find event bus module"),!1;t.byteboost.warn("Next event is invalid. Removing it",e),t.removeNextEvent()}return!0}},750:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beforeMiddlewares=void 0;t.beforeMiddlewares=[e=>0===e.delay.toWait||(e.delay.waited=e.delay.waited+(Date.now()-e.delay.lastPoll),e.delay.lastPoll=Date.now(),e.delay.waited>e.delay.toWait)]},134:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseDataModule=t.BaseModule=void 0;const o=s(356),r=s(580),n=s(850);class i{state;namespace;isPolling=!1;_eventBus;constructor(e){this.namespace=e}get byteboost(){return window._byteboost}bindEventBus(e){this._eventBus=e}get eventBus(){if("eventBus"===this.namespace)throw Error("Cannot access EventBus on EventBus");return this._eventBus}emit(e,t){this.eventBus.dispatch(this.namespace,e,t)}on(e,t){this.eventBus.listen(this.namespace,e,t)}onPoll(){}receivePolls(){var e=this.byteboost.getModule("eventBus");if(!e)throw new Error("Unable to find the event bus module. unable to start module polling.");e.addModulePolling(this),this.isPolling=!0}cleanup(){}onBuildNeeded(){var e=this.build();this.state={updated:Date.now(),...e}}unpack(e){this.state=e,this.bindDefaultPersistantData(e)}bindDefaultPersistantData(e){this.state.updated=Date.now()}async pack(){return this.state}}t.BaseModule=i;t.BaseDataModule=class extends i{syncPathName;isDataModule=!0;isSyncActive=!1;constructor(e){super(e),this.syncPathName=this.namespace}initialize(){this.doSync()}formatSyncData(){return(0,r.cloneObject)(this.state)}baseFormatSyncData(e){var t=this.formatSyncData();return!0===t?._empty?(this.byteboost.debug("will dispatch onSyncSkipped",this.namespace),e.dispatchEvent(new o.ByteEvent(this.namespace,"onSyncSkipped",t,90).wait(15e3)),null):{data:t,_syncRequestedAt:Date.now()}}sync(e){var t=this.baseFormatSyncData(e);t&&e.dispatchEvent(new o.ByteEvent("request","sync",{path:n.BASE_API_URL+"/v1beta/events/"+(this.syncPathName??this.namespace),event:new o.ByteEvent(this.namespace,"onSync",{},90).flatten(),data:t},100).wait(15e3))}doSync(){const t=this.byteboost.getModule("eventBus");if(!t)throw"[byteboost] un-able to get eventBus";this.isSyncActive=!0,t.declareGarbage(this.namespace,"onSync"),t.declareGarbage(this.namespace,"onSyncSkipped"),t.listen(this.namespace,"onSyncSkipped",e=>{!0===e?._empty&&this.sync(t)}),t.listen(this.namespace,"onSync",e=>{this.onSync(e),this.sync(t)}),this.sync(t)}async forceSend(){var e,t;this.isSyncActive&&(e=this.byteboost.getModule("eventBus"))&&(e=this.baseFormatSyncData(e))&&(t=this.byteboost.getModule("request"))&&t.post(n.BASE_API_URL+"/v1beta/events/"+this.syncPathName,e)}}},230:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=t.ConsoleType=void 0;var o,r=s(134);const n=s(397),i=s(601),a=s(580);(s=o||(t.ConsoleType=o={})).DEBUG="debug",s.ERROR="error",s.INFO="info",s.LOG="log",s.WARN="warn",s.DIR="dir",s.DIRXML="dirxml",s.TABLE="table",s.TRACE="trace",s.GROUP="group",s.GROUPCOLLAPSED="groupCollapsed",s.GROUPEND="groupEnd",s.CLEAR="clear",s.COUNT="count",s.COUNTRESET="countReset",s.ASSERT="assert",s.PROFILE="profile",s.PROFILEEND="profileEnd",s.TIME="time",s.TIMELOG="timeLog",s.TIMEEND="timeEnd",s.TIMESTAMP="timeStamp",s.CONTEXT="context",s.CREATETASK="createTask",s.MEMORY="memory";class c extends r.BaseDataModule{logTrackingEnabled=!0;minLogsLength=500;maxLogsLength=1e3;bindedConsoleMethods=[];core;constructor(){super("logger"),this.syncPathName="console"}build(){for(var e in console)console[e]&&this.bindedConsoleMethods.push(e);var t,s={};for(t of this.bindedConsoleMethods)s[t]={logs:[],count:0};return s}cleanCircularLogObjects(){this.state.log=(0,i.removeCircular)((0,a.cloneObject)(this.state.log)),this.state.error=(0,i.removeCircular)((0,a.cloneObject)(this.state.error)),this.state.warn=(0,i.removeCircular)((0,a.cloneObject)(this.state.warn))}cleanup(){this.logTrackingEnabled=!1,this.byteboost.debug("stopped tracking logs")}async pack(){return this.cleanCircularLogObjects(),this.state}formatSyncData(){var e,t={logs:[]};for(e in o){var s=this.state[e.toLowerCase()];!s||s.logs.length<=0||("clear"===e.toLowerCase()?t.logs=[...t.logs,...s.logs.map(e=>({...e,value:"CONSOLE_CLEAR"}))]:t.logs=[...t.logs,...s.logs.map(e=>({...e,value:e.value.map(e=>{if("object"==typeof e)try{return JSON.stringify(e)}catch(e){}return e}).join("").replace(/\n/g,"[[{{NEW_LINE}}]]")}))])}return 0===t.logs.length?{_empty:!0}:t}onSync(e){if(e.response.success)for(var t in o){t=this.state[t.toLowerCase()];!t||0===t.count&&0===t.logs.length||(t.logs=this.eventBus.cleanSyncedData(t.logs,e),t.count=t.logs.length)}else this.byteboost.error("Unable to sync logger module.")}boot(){const r=this;var e,t=this.byteboost.getModule("core");for(e in t&&(this.core=t),this.eventBus.listen("logger","log",e=>{var t=e.kind;this.state[t]||(this.state[t]={count:0,logs:[]}),this.state[t].count++,this.state[t].logs.push(e),this.handleMemoryFor(t)}),this.doSync(),this.byteboost.debug("tracking logs"),console)e=e,console[e]=function(t,s,o){if(s)return function(...e){s.apply(t,Array.prototype.slice.apply(e)),r.logTrackingEnabled&&r.trackLog(o,...e)}}(console,console[e],e)}handleMemoryFor(e){var t=this.state[e];t.logs.length>this.maxLogsLength&&(this.byteboost.debug("removing logs",e),t.logs=t.logs.slice(t.logs.length-this.minLogsLength,t.logs.length),t.count=t.logs.length)}async trackLog(e,...t){(0,n.isDev)()&&"string"==typeof t[0]&&t[0].includes("[byteboost]")||(t={value:t,when:Date.now(),kind:e,where:this.core?this.core.getFormattedPath():window.location.pathname},this.byteboost.debug("dispatching logger info",t),this.eventBus.dispatch("logger","log",t))}}t.Logger=c},882:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pinger=void 0;var o=s(134);const r=s(850);class n extends o.BaseModule{requestModule;lastPingTimestamp=0;constructor(){super("pinger")}async onPoll(){var e=this.byteboost.initializedAt,e=(Date.now()-e)/1e3;if(!(e<180)){if(0!==this.lastPingTimestamp)if((Date.now()-this.lastPingTimestamp)/1e3<180)return;this.lastPingTimestamp=Date.now();e=await this.requestModule.get(r.BASE_API_URL+"/v1beta/session/ping");401===e.status&&this.byteboost.cleanup(),this.byteboost.debug("DID PING",e)}}boot(){var e=this.byteboost.getModule("request");if(!e)throw new Error("Unable to get request module!");this.requestModule=e,this.receivePolls()}build(){return{}}}t.Pinger=n},258:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestModule=void 0;var o=s(134);const r=s(356);class n extends o.BaseModule{persistantHeaders={};lastPostTimestamp=0;constructor(){super("request")}boot(){this.persistantHeaders={"X-Auth-Token":this.byteboost.getApiKey()},this.eventBus.listen(this.namespace,"get",async e=>{var t=await this.get(e.path),e=new r.ByteEvent("","",{}).sharpen(e.event);e.setPayload(t),this.eventBus.dispatchEvent(e)}),this.eventBus.listen(this.namespace,"sync",async e=>{var t=await this.post(e.path,e.data.data),s=new r.ByteEvent("","",{}).sharpen(e.event),t={response:t,responseTimestamp:Date.now(),data:e.data};s.setPayload(t),this.eventBus.dispatchEvent(s)})}isSuccessResponse(e){return 199<e&&e<300}async post(e,t){this.lastPostTimestamp=Date.now();try{var s=await fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json",...this.persistantHeaders},method:"POST",body:JSON.stringify(t)});try{var o=await s.json();return this.isSuccessResponse(s.status)?{status:s.status,body:o,success:!0}:{status:s.status,body:o,success:!1}}catch(e){return this.isSuccessResponse(s.status)?{status:s.status,body:{},success:!0}:(this.byteboost.error("Unexpected post request error."),console.log(s.body,105),{status:s.status,body:s.body,success:!1})}}catch(e){return this.byteboost.error("Unexpected post request error."),{status:500,body:{},success:!1}}}async get(e){var e=await fetch(e,{credentials:"include",headers:{...this.persistantHeaders,Accept:"application/json"}}),t=await e.json();return this.isSuccessResponse(e.status)?{status:e.status,body:t,success:!0}:{status:e.status,body:t,success:!1}}build(){return{apiKey:""}}}t.RequestModule=n},252:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preflightChecks=void 0;const c=s(850);t.preflightChecks=async()=>{if(void 0===window.performance||void 0===window.performance.now)return!1;try{window.performance.now()}catch(e){return!1}if(!0===window._startingByteboost)return console.log("already starting byteboost"),!1;try{if(!("DOMParser"in window))return!1;if(!("TextEncoder"in window&&"TextDecoder"in window))return!1;if(!("XMLSerializer"in window))return!1;new XMLSerializer}catch(e){return!1}if(!window.byteboostKey){var t=document.querySelector("[data-byteboost-key]");if(!t)return console.log("no api key"),!1;t=t.getAttribute("data-byteboost-key");if(!t)return console.log("no api key"),!1;window.byteboostKey=t}if(window._startingByteboost=!0,!l())return!1;var s,t=await u();try{var o=window.performance.now(),r=await fetch(c.BASE_API_URL+"/v1beta/session?hasAdblocker="+t,{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey}});if(console.log("fetched session with status",r.status),!(199<(s=r.status)&&s<300))return console.log("unable to get session"),!1;var n,i=window.performance.now()-o;if(console.log("requestTook",i),650<i)return n=await fetch(c.BASE_API_URL+"/v1beta/session/kill?networkPreflightFailed=true",{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey}}),console.log("killed session with status",n.status),!1;var a=await r.text();let e=-1;try{if((e=parseInt(a))<0||2<e)throw"invalid level"}catch(e){return console.log("unable to parse obfuscate level",e),!1}return{success:!0,obfuscateLevel:e}}catch(e){return!1}};const l=()=>{var s=[];for(let e=0;e<10;e++){var o=window.performance.now();let t=0;for(let e=0;e<1e6;e++)t+=(t*e+10*e)/(10*e);o=window.performance.now()-o;s.push(o)}let e=0;for(const t of s)e+=t;return e/=s.length,console.log("performance result",e,"<",125),!(125<e)},u=async()=>{let t=!1;try{await fetch(new Request("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js")).catch(e=>t=!0)}catch(e){t=!0}return t}},429:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uncompressJSON=t.compressJSON=void 0;t.compressJSON=e=>{let r={},n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0,a=1;const c=e=>{var t,s=[];for(t of e)"object"!=typeof t?s.push(t):Array.isArray(t)?s.push(c(t)):s.push(l(t));return s},l=e=>{var t,s={};for(t in e){var o=(e=>{if(e in r)return r[e];let t="";if(i>=n.length&&(i=0,a++),1!==a)for(let e=0;e<a;e++)i+e>=n.length&&(i=0,a++),t+=n[i+e];else t=n[i];var s=`£${t}£`;return i++,r[e]=s})(t);"object"!=typeof e[t]?s[o]=e[t]:Array.isArray(e[t])?s[o]=c(e[t]):s[o]=l(e[t])}return s};var t,e=l(e),s={};for(t in r)s[r[t]]=t;return[e,s]};t.uncompressJSON=(e,r)=>{const n=e=>{var t,s=[];for(t of e)"object"!=typeof t?s.push(t):Array.isArray(t)?s.push(n(t)):s.push(i(t));return s},i=e=>{var t,s={};for(t in e){o=t;var o=r[o];"object"!=typeof e[t]?s[o]=e[t]:Array.isArray(e[t])?s[o]=n(e[t]):s[o]=i(e[t])}return s};return i(e)}},580:(e,l,t)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.cloneObject=void 0;const u=t(601);l.cloneObject=e=>{if("object"!=typeof e)return e;if(Array.isArray(e))return e;let t=(0,u.removeCircular)(e),s={};const o=e=>"object"!=typeof e,r=e=>!!Array.isArray(e),n=e=>e.map(e=>o(e)?e:(r(e)?n:(0,l.cloneObject))(e));var i,a;for(i in t){var c=t[i];a=i,c=c,o(c)?s[a]=c:r(c)?s[a]=n(c):s[a]=(0,l.cloneObject)(t[a])}return s}},765:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebWorker=t.WorkerHandler=void 0;t.WorkerHandler=class{initialized=!1;filePath;workerState={ready:!1,upgrading:!1};currentWorker;workerRegistration;_subscriptions=new Map;_messageQueue=[];constructor(e,t){if("undefined"==typeof window)throw new Error("Unable to initialize service worker on server");window._byteboost_workers||(window._byteboost_workers=new Map);var s=window._byteboost_workers.get(e);if(s)return s;this.filePath=t,window._byteboost_workers.set(e,this)}canCommunicate(){return this.workerState.ready&&!this.workerState.upgrading}on(e,t){this._subscriptions.set(e,t)}emit(e,t){this.currentWorker&&this.canCommunicate()?this.currentWorker.postMessage({id:e,payload:t}):this._messageQueue.push({id:e,payload:t})}onReady(){if(this.workerState.ready=!0,0!==this._messageQueue.length)if(this.currentWorker&&this.canCommunicate()){console.log("sending skipped messages!",this._messageQueue);for(const e of this._messageQueue)this.emit(e.id,e.payload)}else console.log("UNABLE TO COMMUNTICATE in onReady. This shouldn't happen")}onWorkerMessage(e){var e=e.data,t=this._subscriptions.get(e.id);t&&t(e.payload)}registerWorker(e){console.log("got new worker connection!",e),this.currentWorker=e,navigator.serviceWorker.removeEventListener("message",e=>{this.onWorkerMessage(e)}),navigator.serviceWorker.addEventListener("message",e=>{this.onWorkerMessage(e)}),this.onReady()}kill(){this.workerRegistration&&this.workerRegistration.unregister()}init(){this.initialized||(this.initialized=!0,navigator&&"serviceWorker"in navigator&&navigator.serviceWorker.register(this.filePath).then(e=>{(this.workerRegistration=e).active&&(console.log("GOT ACTIVE",e.installing),this.registerWorker(e.active)),e.addEventListener("updatefound",()=>{this.workerState.upgrading=!0;const t=e.installing;t&&(console.log("New worker is being installed for:",this.filePath),t.onstatechange=e=>{"activated"===t.state&&(this.workerState.upgrading=!1,this.workerState.ready=!1,this.registerWorker(t))})})}))}};const s={"screenshot-parser":"http://localhost:3000/screenshotParser.js"};t.WebWorker=class{name;filePath;worker;isActive=!1;_subscriptions=new Map;unsentMessages=[];constructor(e){this.name=e,this.filePath=s[e],this.start()}emit(e,t){this.isActive?this.worker.postMessage({id:e,payload:t}):this.unsentMessages.push({id:e,payload:t})}on(e,t){this._subscriptions.set(e,t)}start(){console.log("starting worker",this.filePath,this.getWorkerUrl()),this.worker=new Worker(this.getWorkerUrl()),this.worker.onmessage=e=>{var t=e.data.id,e=e.data.payload;if("_self"===t&&"string"==typeof e&&"active"===e){if(this.isActive=!0,0!==this.unsentMessages.length)for(const s of this.unsentMessages)this.worker.postMessage(s)}else this._subscriptions.has(t)&&this._subscriptions.get(t)(e)}}getWorkerUrl(){var e=`importScripts( "${this.filePath}" );`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}}},924:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPersistantWorker=t.killPersistantWorkers=t.setupPersistantWorkers=void 0;const o=s(765);t.setupPersistantWorkers=async()=>{new o.WorkerHandler("network-tracker","/byteboost.js").init()},t.killPersistantWorkers=async()=>{window._byteboost_workers.forEach(e=>{e.kill()})};t.getPersistantWorker=e=>window._byteboost_workers.get(e)}},r={};(function e(t){var s=r[t];return void 0===s&&(s=r[t]={exports:{}},o[t].call(s.exports,s,s.exports,e)),s.exports})(607)})();
