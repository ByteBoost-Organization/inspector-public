(()=>{var o={961:(e,t,s)=>{f=String.fromCharCode,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",n={};var f,o,r,n,a,i=a={compressToBase64:function(e){if(null==e)return"";var t=a._compress(e,6,function(e){return o.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:a._decompress(t.length,32,function(e){return c(o,t.charAt(e))})},compressToUTF16:function(e){return null==e?"":a._compress(e,15,function(e){return f(e+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:a._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(e){for(var t=a.compress(e),s=new Uint8Array(2*t.length),o=0,r=t.length;o<r;o++){var n=t.charCodeAt(o);s[2*o]=n>>>8,s[2*o+1]=n%256}return s},decompressFromUint8Array:function(e){if(null==e)return a.decompress(e);for(var t=new Array(e.length/2),s=0,o=t.length;s<o;s++)t[s]=256*e[2*s]+e[2*s+1];var r=[];return t.forEach(function(e){r.push(f(e))}),a.decompress(r.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":a._compress(e,6,function(e){return r.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),a._decompress(t.length,32,function(e){return c(r,t.charAt(e))}))},compress:function(e){return a._compress(e,16,function(e){return f(e)})},_compress:function(e,t,s){if(null==e)return"";for(var o,r,n,a,i={},c={},l="",h=2,u=3,d=2,p=[],b=0,_=0,y=0;y<e.length;y+=1)if(n=e.charAt(y),Object.prototype.hasOwnProperty.call(i,n)||(i[n]=u++,c[n]=!0),a=l+n,Object.prototype.hasOwnProperty.call(i,a))l=a;else{if(Object.prototype.hasOwnProperty.call(c,l)){if(l.charCodeAt(0)<256){for(o=0;o<d;o++)b<<=1,_==t-1?(_=0,p.push(s(b)),b=0):_++;for(r=l.charCodeAt(0),o=0;o<8;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1}else{for(r=1,o=0;o<d;o++)b=b<<1|r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r=0;for(r=l.charCodeAt(0),o=0;o<16;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1}0==--h&&(h=Math.pow(2,d),d++),delete c[l]}else for(r=i[l],o=0;o<d;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1;0==--h&&(h=Math.pow(2,d),d++),i[a]=u++,l=String(n)}if(""!==l){if(Object.prototype.hasOwnProperty.call(c,l)){if(l.charCodeAt(0)<256){for(o=0;o<d;o++)b<<=1,_==t-1?(_=0,p.push(s(b)),b=0):_++;for(r=l.charCodeAt(0),o=0;o<8;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1}else{for(r=1,o=0;o<d;o++)b=b<<1|r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r=0;for(r=l.charCodeAt(0),o=0;o<16;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1}0==--h&&(h=Math.pow(2,d),d++),delete c[l]}else for(r=i[l],o=0;o<d;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1;0==--h&&(h=Math.pow(2,d),d++)}for(r=2,o=0;o<d;o++)b=b<<1|1&r,_==t-1?(_=0,p.push(s(b)),b=0):_++,r>>=1;for(;;){if(b<<=1,_==t-1){p.push(s(b));break}_++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:a._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(e,t,s){for(var o,r,n,a,i,c,l=[],h=4,u=4,d=3,p="",b=[],_={val:s(0),position:t,index:1},y=0;y<3;y+=1)l[y]=y;for(r=0,a=Math.pow(2,2),i=1;i!=a;)n=_.val&_.position,_.position>>=1,0==_.position&&(_.position=t,_.val=s(_.index++)),r|=(0<n?1:0)*i,i<<=1;switch(r){case 0:for(r=0,a=Math.pow(2,8),i=1;i!=a;)n=_.val&_.position,_.position>>=1,0==_.position&&(_.position=t,_.val=s(_.index++)),r|=(0<n?1:0)*i,i<<=1;c=f(r);break;case 1:for(r=0,a=Math.pow(2,16),i=1;i!=a;)n=_.val&_.position,_.position>>=1,0==_.position&&(_.position=t,_.val=s(_.index++)),r|=(0<n?1:0)*i,i<<=1;c=f(r);break;case 2:return""}for(o=l[3]=c,b.push(c);;){if(e<_.index)return"";for(r=0,a=Math.pow(2,d),i=1;i!=a;)n=_.val&_.position,_.position>>=1,0==_.position&&(_.position=t,_.val=s(_.index++)),r|=(0<n?1:0)*i,i<<=1;switch(c=r){case 0:for(r=0,a=Math.pow(2,8),i=1;i!=a;)n=_.val&_.position,_.position>>=1,0==_.position&&(_.position=t,_.val=s(_.index++)),r|=(0<n?1:0)*i,i<<=1;l[u++]=f(r),c=u-1,h--;break;case 1:for(r=0,a=Math.pow(2,16),i=1;i!=a;)n=_.val&_.position,_.position>>=1,0==_.position&&(_.position=t,_.val=s(_.index++)),r|=(0<n?1:0)*i,i<<=1;l[u++]=f(r),c=u-1,h--;break;case 2:return b.join("")}if(0==h&&(h=Math.pow(2,d),d++),l[c])p=l[c];else{if(c!==u)return null;p=o+o.charAt(0)}b.push(p),l[u++]=o+p.charAt(0),o=p,0==--h&&(h=Math.pow(2,d),d++)}}};function c(e,t){if(!n[e]){n[e]={};for(var s=0;s<e.length;s++)n[e][e.charAt(s)]=s}return n[e][t]}void 0!==(s=function(){return i}.call(t,s,t,e))&&(e.exports=s)},607:function(e,t,s){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,s,o){void 0===o&&(o=s);var r=Object.getOwnPropertyDescriptor(t,s);r&&("get"in r?t.__esModule:!r.writable&&!r.configurable)||(r={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,o,r)}:function(e,t,s,o){e[o=void 0===o?s:o]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||o(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(s(397),t)},825:(e,r,t)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.askForSession=r.isSuccessResponse=void 0;const n=t(782),a=t(850),i=t(601),c=t(978);r.isSuccessResponse=e=>199<e&&e<300;r.askForSession=async()=>{let e=c.localStorageInterface.getInspectorId();if(!e&&(e=(0,c.generateInspectorId)(),c.localStorageInterface.setInspectorId(e),!c.localStorageInterface.getInspectorId()))return console.warn("unable to set inspector id. shutting down"),window._byteboost&&window._byteboost.purge(),!1;try{var t,s=window.performance.now(),o=await fetch(`${a.BASE_API_URL}/v1beta/session?hasAdblocker=false&id=${e}&where=`+window.location.pathname,{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey,"x-bb-st":c.localStorageInterface.getItem(c.BYTEBOOST_SESSION_START_KEY)??""}});return(0,r.isSuccessResponse)(o.status)?(t=await o.json(),window.performance.now()-s>n.MAXIMUM_SESSION_REQUEST_RESPONSE_TIME&&"reuse"!==t.sessionState?(await fetch(a.BASE_API_URL+"/v1beta/session/kill?networkPreflightFailed=true",{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey}}),c.localStorageInterface.purge(),!1):(c.localStorageInterface.setItem("bb_sess","true"),{obfuscateLevel:(0,i.tryParseNumber)(t.obfuscateLevel)})):(c.localStorageInterface.purge(),!1)}catch(e){return!1}}},782:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ABORT_COOLDOWN_MILLIS=t.ABORT_COOLDOWN_AFTER_ATTEMPTS=t.ABORT_SYNC_AFTER_MILLIS=t.MODULE_DEBOUNCES_UNTIL_FORCE_SYNC=t.MODULE_SYNC_DEBOUNCE_TIME=t.PURGE_STATE_AFTER_SYNC_FAILED_TIMES=t.NAVIGATION_UNLOAD_STATE_LIMIT=t.SESSION_INACTIVE_KILL_TIME=t.PING_INTERVAL_IN_SECONDS=t.MAXIMUM_SESSION_REQUEST_RESPONSE_TIME=t.CAPTURE_SCREENSHOW_ON_MOUSE_MOVE_DIFFERENCE=t.MINIMUM_TIME_BETWEEN_SMALL_NAVIGATION_SCREENSHOTS=t.MINIMUM_TIME_BETWEEN_FORCED_SCREENSHOTS=t.MINIMUM_TIME_BETWEEN_SCREENSHOTS=t.CLICK_GROUP_INTERVAL=t.CLICK_GROUP_RADIUS=t.WATCHER_SLOW_TIMEOUT_THRESHOLD=t.WATCHER_SLOW_TIMEOUT_SPEEDUP_STEP_MULTIPLIER=t.WATCHER_TIMEOUT_CHANGE_THRESHOLD=t.WATCHER_SPEED_UP_STEP=t.WATCHER_CYCLES_BETWEEN_EVAL=t.WATCHER_MAX_TIMEOUT=t.WATCHER_MIN_TIMEOUT=t.WATCHER_STARTING_TIMEOUT=void 0,t.WATCHER_STARTING_TIMEOUT=50,t.WATCHER_MIN_TIMEOUT=10,t.WATCHER_MAX_TIMEOUT=4e3,t.WATCHER_CYCLES_BETWEEN_EVAL=5,t.WATCHER_SPEED_UP_STEP=40,t.WATCHER_TIMEOUT_CHANGE_THRESHOLD=100,t.WATCHER_SLOW_TIMEOUT_SPEEDUP_STEP_MULTIPLIER=3,t.WATCHER_SLOW_TIMEOUT_THRESHOLD=1500,t.CLICK_GROUP_RADIUS=20,t.CLICK_GROUP_INTERVAL=400,t.MINIMUM_TIME_BETWEEN_SCREENSHOTS=2e3,t.MINIMUM_TIME_BETWEEN_FORCED_SCREENSHOTS=1e3,t.MINIMUM_TIME_BETWEEN_SMALL_NAVIGATION_SCREENSHOTS=1500,t.CAPTURE_SCREENSHOW_ON_MOUSE_MOVE_DIFFERENCE=1e4,t.MAXIMUM_SESSION_REQUEST_RESPONSE_TIME=3250,t.PING_INTERVAL_IN_SECONDS=180,t.SESSION_INACTIVE_KILL_TIME=1e3*t.PING_INTERVAL_IN_SECONDS,t.NAVIGATION_UNLOAD_STATE_LIMIT=2e4,t.PURGE_STATE_AFTER_SYNC_FAILED_TIMES=3,t.MODULE_SYNC_DEBOUNCE_TIME=1250,t.MODULE_DEBOUNCES_UNTIL_FORCE_SYNC=15,t.ABORT_SYNC_AFTER_MILLIS=5e3,t.ABORT_COOLDOWN_AFTER_ATTEMPTS=2,t.ABORT_COOLDOWN_MILLIS=5e3},850:(e,c,t)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ByteBoost=c.BASE_API_URL=void 0;var s=t(356),o=t(230),r=t(258),n=t(81);const l=t(429);var a=t(410),i=t(882),h=t(958),u=t(670),d=t(592),p=t(872);const b=t(978),_=t(923),y=t(555);var f=t(838),g=t(886);const v=t(825),E=t(675),m=t(601);t=t(798);c.BASE_API_URL="https://external.api.byteboost.io";const S={DEBUG:"#5075DA",INFO:"#50DA7C",ERROR:"#DA6550",WARN:"#DAB250"},I=[s.EventBus,h.PainpointTracker,r.RequestModule,f.DOM,o.Logger,n.ErrorModule,a.Navigations,u.Clicks,d.Screenshots,p.SessionRequests,i.Pinger,g.ClientPerformance,t.RequestErrors];c.ByteBoost=class{modules;versionManager;performance;navigator;syncInitializedAt=0;apiKey;obfuscateLevel;_devMode=!1;minified;inspectorId;isInitialPageLoad=!1;shouldInflate;isTest=!1;constructor(e){("_byteboost_dev"in window&&"boolean"==typeof window._byteboost_dev&&!0===window._byteboost_dev||"true"===window.localStorage.getItem("BB_IS_DEV"))&&(this._devMode=!0),("_byteboost_test"in window&&"boolean"==typeof window._byteboost_test&&!0===window._byteboost_test||"true"===window.localStorage.getItem("BB_IS_TEST"))&&(this.isTest=!0),this.info("starting",e),this.minified=e.minified,this.info("running "+(this.minified?"minified":"unminified")),this.obfuscateLevel=e.obfuscateLevel,this.navigator=window.navigator,this.performance=window.performance||self.performance,this.apiKey=e.apiKey,this.isInitialPageLoad=e.isInitialPageLoad??!1;let t=b.localStorageInterface.getInspectorId();if(!t&&!this.minified)throw new Error("Unable to find inspector id. Cannot start");!t&&this.minified&&(t=(0,b.generateInspectorId)(),b.localStorageInterface.setInspectorId(t)),this.inspectorId=t,this.versionManager=new _.VersionManager(this);let s=this.getPersistantData();!1===s&&(s={}),this.modules={};for(var o of I){o=new o;s.hasOwnProperty(o.namespace)?o.unpack(s[o.namespace]):o.onBuildNeeded(),this.modules[o.namespace]={namespace:o.namespace,module:o}}window.addEventListener("beforeunload",T),this.shouldInflate=e.shouldInflate,e.shouldInflate&&this.inflate(),this.getMeta()}handleModuleSync(e){for(var t in this.modules){t=this.modules[t].module;!1!==t.isDataModule&&(this.minified?this.minified&&t.canSync&&t.stopSync():(t.onEngineInflated(),t.startSync(e)))}}initializeModules(){for(var e in this.debug("initializing modules"),this.modules){var t=this.modules[e].module;"eventBus"!==e&&t.bindEventBus(this.getModule("eventBus")),t.bootPreload(),t.boot(),this.minified||t.onEngineInflated()}if(this.isInitialPageLoad)for(var s in this.modules)this.modules[s].module.onInitialSessionLoad();this.handleModuleSync(),this.minified||(this.syncInitializedAt=Date.now()),this.shouldInflate||this.getModule("painpointTracker")?.getPainpoints()}onEventBusPoll(){for(const e in this.modules)this.modules[e].module.garbageCollector.collect()}async getMeta(){this.debug("fetching metadata");try{var e=await fetch("https://cdn.byteboost.io/v1beta/metadata",{headers:{Accept:"application/json","X-Auth-Token":window.byteboostKey}});if((0,v.isSuccessResponse)(e.status)){var t=await e.json();if(this.debug(t),!("data"in t&&"obfuscateLevel"in t.data))throw new Error("Invalid metaData structure");var s=(0,m.tryParseNumber)(t.data.obfuscateLevel);if(!1===s)throw new Error("Unable to parse obfuscateLevel");if(!(0,y.validateObfuscateLevel)(s))throw new Error("Unable to save or validate obfuscate level");this.obfuscateLevel=s,b.localStorageInterface.setItem(b.OBFUSCATE_LEVEL_KEY,this.obfuscateLevel.toString());for(const r in this.modules){var o=this.modules[r].module;o.onNewSettings({obfuscateLevel:this.getObfuscateLevel()}),o.onEngineMetaData()}}}catch(e){this.debug("Unable to get meta data.")}}isGatheringSession=!1;async inflate(){if(this.minified&&!this.isGatheringSession){this.isGatheringSession=!0;var e=await(0,v.askForSession)();if(!e)return this.purge();if(0!=e.obfuscateLevel){this.setObfuscateLevel(e.obfuscateLevel);for(const t in this.modules)this.modules[t].module.onNewSettings({obfuscateLevel:this.getObfuscateLevel()})}this.minified=!1,this.isGatheringSession=!1,this.handleMetaDataOnInflation(),this.handleModuleSync(!0)}}getModule(e){if(this.modules[e])return this.modules[e].module}hookIntoEventBus(e){this.getModule("eventBus")?.hookIntoBus(e)}getApiKey(){return this.apiKey}debug(...e){this._devMode&&console.log("%c[byteboost]","color:"+S.DEBUG+";font-weight:bold;",...e)}info(...e){this._devMode&&console.log("%c[byteboost]","color:"+S.INFO+";font-weight:bold;",...e)}warn(...e){this._devMode&&console.log("%c[byteboost]","color:"+S.WARN+";font-weight:bold;",...e)}error(...e){this._devMode&&console.log("%c[byteboost]","color:"+S.ERROR+";font-weight:bold;",...e)}forceInfoLog(...e){console.log("%c[byteboost]","color:"+S.INFO+";font-weight:bold;",...e)}getInspectorId(){return this.inspectorId}async compilePersistantData(){var e,t={};for(e in this.modules){var s=await this.modules[e].module.pack();t[e]=s}return t}async purge(){await this.cleanup(),b.localStorageInterface.purge()}getPersistantData(){try{var e=JSON.parse(b.localStorageInterface.getItem(b.PERSISTANT_DATA_KEY)),t=JSON.parse(b.localStorageInterface.getItem(b.PERSISTANT_DATA_KEY_MAPPING)),s=Date.now(),o=(0,l.uncompressJSON)(e,t);if(this.debug("Uncompression took:",Date.now()-s,"ms"),o)return o;throw"unable to compress"}catch(e){return!1}}logStateItems(){let e=0;for(const s in this.modules){var t=this.modules[s].module;e+=t.garbageCollector.getStateCount()}}enableDevMode(){this._devMode=!0}dev(){this.enableDevMode(),this.inflate()}logSessionStartTime(){try{var e,t=b.localStorageInterface.getItem(b.BYTEBOOST_SESSION_START_KEY);t?(e=parseInt(t),isNaN(e)?console.log("INVALID START TIME"):console.log("js date start",new Date(e))):console.log("INVALID START TIME")}catch(e){console.log("INVALID START TIME (catched)",e)}}handleMetaDataOnInflation(){var e=JSON.parse(b.localStorageInterface.getItem(b.AWAITING_INFLATION_META_DATA_KEY)??"{}");0!==Object.keys(e).length&&this.setMeta(e)}async setMeta(e,t=0){let s={};try{s=JSON.parse(b.localStorageInterface.getItem(b.SYNCED_META_DATA_KEY)??"{}")}catch(e){}let o=!0;if(0!==Object.keys(s).length){var r=Object.keys(e),n=Object.keys(s);if(r.length===n.length)for(const a of r){if(!n.includes(a)){o=!1;break}if(e[a]!==s[a]){o=!1;break}}else o=!1}else o=!1;if(o)this.debug("meta data already synced");else{for(const i of Object.values(e))if(!["string","boolean","number"].includes(typeof i)||Array.isArray(i))throw new Error(`Unable to set meta data. Type ${typeof i} not supported. Supported values: boolean, string, number`);var r=(0,m.roughByteSizeOfObject)(e);if(-1===r)throw new Error("Unable to calculate meta byte size");if(1024<r)throw new Error("Meta data is too large (max 1024 bytes)");this.minified?b.localStorageInterface.setItem(b.AWAITING_INFLATION_META_DATA_KEY,JSON.stringify(e)):(b.localStorageInterface.removeItem(b.AWAITING_INFLATION_META_DATA_KEY),r=await fetch(c.BASE_API_URL+"/v1beta/session/metadata",{method:"POST",credentials:"include",headers:{"X-Auth-Token":window.byteboostKey,"Content-Type":"application/json"},body:JSON.stringify({metadata:e})}),(0,v.isSuccessResponse)(r.status)?b.localStorageInterface.setItem(b.SYNCED_META_DATA_KEY,JSON.stringify(e)):3<=t||setTimeout(()=>{this.setMeta(e,t+1)},1e3))}}async kill(){await fetch(c.BASE_API_URL+"/v1beta/session/kill",{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey}}),this.purge()}async getDump(){var e=await this.compilePersistantData(),t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(JSON.stringify(e,null,2))),t.setAttribute("download","persistant.json"),document.body.appendChild(t),t.click(),document.body.removeChild(t)}hopefullySyncData(e){let t=0;for(const o of e.filter(e=>e.priority.enabled).sort((e,t)=>t.priority.priority-e.priority.priority)){var s=Date.now();if(o.forceSend(),(t+=Date.now()-s)>=E.UNLOAD_REQUEST_TIME_LIMIT_MS)break}}async cleanup(){try{this.debug("cleaning up");var e,t=[];for(e in this.modules){var s=this.modules[e].module;s.cleanup(),s.isDataModule&&t.push(s)}this.hopefullySyncData(t);var o=await this.compilePersistantData(),r=(this.debug("Got persistant data",o),Date.now()),[n,a]=(0,l.compressJSON)(o),i=(this.debug("Compression took:",Date.now()-r,"ms"),JSON.stringify(n)),c=JSON.stringify(a);try{b.localStorageInterface.setItem(b.PERSISTANT_DATA_KEY,i),b.localStorageInterface.setItem(b.PERSISTANT_DATA_KEY_MAPPING,c)}catch(e){this.error("Unable to save data to local storage",e)}b.localStorageInterface.setItem("_last_used_bb",Date.now().toString()),window.removeEventListener("beforeunload",T),this.info("terminated"),window._byteboost&&delete window._byteboost}catch(e){this._devMode&&console.log("cleanup error",e)}}setObfuscateLevel(e){this.obfuscateLevel=e}getObfuscateLevel(){return this.obfuscateLevel}};const T=async()=>{await window._byteboost.cleanup()}},264:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GarbageCollector=void 0;const n=s(850),a=s(601);t.GarbageCollector=class{myModule;optimization;isOptimizing=!1;constructor(e){this.myModule=e}setOptimization(e){this.isOptimizing=!0,this.optimization=e}collect(){if(this.isOptimizing&&(this.myModule.byteboost.minified||!this.myModule.isDataModule||!this.myModule.didLastRequestSucceed)){let e={};for(var[t,s]of(0,a.ObjectEntries)(this.optimization)){var o=this.myModule.state[t];s?Array.isArray(o)?o.length>s.count&&(s=this.myModule.state[t].slice(0,Math.floor(this.myModule.state[t].length/2)),e[t]=s,this.myModule.state[t]=o.slice(Math.floor(o.length/2))):this.myModule.byteboost.warn(this.myModule.namespace+" has garbage optimization that isn't an array: "+t.toString()):this.myModule.byteboost.warn(this.myModule.namespace+" unable to find optimization info for path: "+t.toString())}var r;this.myModule.isDataModule&&0!==(r=Object.keys(e)).length&&(1<r.length&&(this.myModule.byteboost.warn(`Found multiple garbage collected state items for: ${this.myModule.namespace}. picking: `+r[0].toString()),e={[r[0]]:e[r[0]]}),r=this.myModule.formatSyncData(e),this.myModule.byteboost.getModule("request")?.post(n.BASE_API_URL+"/v1beta/events/dumps",{data:r[Object.keys(r)[0]],type:this.myModule.apiNamespace,inspectorId:this.myModule.byteboost.getInspectorId()}))}}getStateCount(){let e=0;for(const s in this.optimization){var t=this.myModule.state[s];Array.isArray(t)?e+=t.length:this.myModule.byteboost.warn(this.myModule.namespace+" has garbage optimization that isn't an array: "+s)}return e}}},397:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDev=t.wrapWindow=void 0;const o=s(850),r=s(252),n=s(978),a=s(924);window.byteboost={setSessionMetaData:e=>{"_byteboost"in window?window._byteboost.setMeta(e):n.localStorageInterface.setItem(n.AWAITING_INFLATION_META_DATA_KEY,JSON.stringify(e))}};t.wrapWindow=()=>{if("undefined"!=typeof window&&!window._byteboost&&!window._startingByteboost){const t=async()=>{await(0,a.setupPersistantWorkers)();var e=await(0,r.preflightChecks)();!1!==e&&e?("_byteboost_dev"in window&&"boolean"==typeof window._byteboost_dev&&!0===window._byteboost_dev&&console.log("preflight succeeded"),window._byteboost=new o.ByteBoost({apiKey:window.byteboostKey,startByteboost:t,obfuscateLevel:e.obfuscateLevel,minified:!0,isInitialPageLoad:e.isInitialPageLoad,shouldInflate:e.shouldInflate}),window._byteboost.initializeModules()):("_byteboost_dev"in window&&"boolean"==typeof window._byteboost_dev&&!0===window._byteboost_dev&&console.log("preflight failed"),await(0,a.killPersistantWorkers)())};try{t()}catch(e){}}},(0,t.wrapWindow)();t.isDev=()=>!0},601:function(e,t,s){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.roughByteSizeOfObject=t.ObjectEntries=t.isNumber=t.tryParseNumber=t.randomString=t.uncompressString=t.compressString=t.findCircular=t.removeCircular=void 0;const r=o(s(961));t.removeCircular=function(e){return JSON.parse(JSON.stringify(e,(()=>{const s=new WeakSet;return(e,t)=>{if("object"==typeof t&&null!==t){if(s.has(t))return;s.add(t)}return t}})()))},t.findCircular=function(e){var r=[],n=[],a=new Set,i=!1;return function e(t,s){if(!t||"object"==typeof t)if(a.has(t))i=!0;else{for(var o in r.push(s),n.push(t),a.add(t),t)Object.prototype.hasOwnProperty.call(t,o)&&e(t[o],o);r.pop(),n.pop(),a.delete(t)}}(e,"__45__circ__initial__"),i};t.compressString=e=>null==e?"":r.default.compress(e),t.uncompressString=e=>null==e?"":r.default.decompress(e),t.randomString=t=>{let s="";var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=o.length;for(let e=0;e<t;e++)s+=o.charAt(Math.floor(Math.random()*r));return s},t.tryParseNumber=e=>{try{var t=typeof e;if("number"!=t&&"string"!=t)return!1;if("number"==t)return e;var s=parseInt(e);if(isNaN(s))throw"NaN";return s}catch(e){return!1}},t.isNumber=e=>!1!==(0,t.tryParseNumber)(e),t.ObjectEntries=e=>Object.entries(e);t.roughByteSizeOfObject=s=>{try{var o=[],r=[s];let e=0,t=0;for(;r.length;){if(300<++t)throw new Error("Max stack exceeded");var n=r.pop();switch(typeof n){case"boolean":e+=4;break;case"string":e+=2*n.length;break;case"number":e+=8;break;case"object":if(!o.includes(n)){o.push(n);for(const a in n)n.hasOwnProperty(a)&&r.push(n[a])}}}return e}catch(e){return-1}}},670:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Clicks=void 0;const o=s(782);var r=s(134);const n=s(601),a=s(580),i=s(675);class c extends r.BaseDataModule{_syncStatus={syncRequestedAt:-1,isSyncing:!1};constructor(){super("clicks"),this.priority={enabled:!0,priority:i.DATA_MODULE_UNLOAD_PRIORITY.CLICKS},this.garbageCollector.setOptimization({clicks:{count:150}}),this.setSyncVariable("clicks")}getMousePos(e){return{x:e?.clientX??e?.pageX??-1,y:e?.clientY??e?.pageY??-1}}onClick(t){var e=this.state.clicks.find(e=>t.x-o.CLICK_GROUP_RADIUS<e.x&&t.x+o.CLICK_GROUP_RADIUS>e.x&&t.y-o.CLICK_GROUP_RADIUS<e.y&&t.y+o.CLICK_GROUP_RADIUS>e.y&&t.when-o.CLICK_GROUP_INTERVAL<e.when);e?!0===this._syncStatus.isSyncing&&e.when<this._syncStatus.syncRequestedAt&&-1!==this._syncStatus.syncRequestedAt?this.addState(t):(e.count++,this.emit("count_updated",{count:e.count})):(this.addState(t),this.emit("count_updated",{count:1}))}gatherRelevantElementData(e){return{innerHTML:(0,n.compressString)(e.innerHTML),outerHTML:(0,n.compressString)(e?.outerHTML),scrollHeight:e?.scrollHeight,scrollLeft:e?.scrollLeft,scrollTop:e?.scrollTop,scrollWidth:e?.scrollWidth,scrollLeftMax:e?.scrollLeftMax,scrollTopMax:e?.scrollTopMax,clientHeight:e?.clientHeight,clientLeft:e?.clientLeft,clientTop:e?.clientTop,clientWidth:e?.clientWidth,attrId:e.getAttribute("id")??void 0,attrClassName:e.getAttribute("class")??void 0,attrStyle:e.getAttribute("style")??void 0}}getAppropriateClickEvent(e,t){var s=e.target||e.srcElement,e={...this.getMousePos(e),when:t||Date.now(),count:1,where:this.getCurrentPath()};return s?(t=s,{...e,element:this.gatherRelevantElementData(t),where:this.getCurrentPath()}):e}boundedClickListener(e){var t=Date.now(),e=(this.byteboost.getModule("screenshots")?.captureScreenshot(),this.getAppropriateClickEvent(e,t));this.emit("click",e)}boot(){this.on("click",e=>{this.onClick(e)}),this.on("count_updated",()=>{}),document.addEventListener("click",l,{capture:!0})}build(){return{clicks:[]}}cleanup(){document.removeEventListener("click",l)}formatSyncData(e){return e.clicks&&0!==e.clicks.length?(e=(0,a.cloneObject)(e),this._syncStatus={isSyncing:!0,syncRequestedAt:Date.now()},e):{_empty:!0}}onSync(e){e.response.success?(this.state.clicks=this.eventBus.cleanSyncedData(this.state.clicks,e),this._syncStatus={isSyncing:!1,syncRequestedAt:-1}):this.byteboost.error("Unable to sync clicks module.")}}t.Clicks=c;const l=e=>{var t;window._byteboost&&(t=window._byteboost.getModule("clicks"))&&t.boundedClickListener(e)}},838:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOM=void 0;var o,r=s(134);const n=s(675),a=s(580);(s=o=o||{}).DOMContentLoaded="DOMContentLoaded",s.DocumentLoaded="DocumentLoaded",s.DocumentUnloaded="DocumentUnloaded";class i extends r.BaseDataModule{constructor(){super("dom"),this.apiNamespace="domstates",this.priority={enabled:!0,priority:n.DATA_MODULE_UNLOAD_PRIORITY.DOM_STATES},this.garbageCollector.setOptimization({domStates:{count:100}}),this.setSyncVariable("domStates")}getLatestUnloadState(){if(null!=this.state.lastUnloadEvent)return this.state.lastUnloadEvent;let e=null,t=0;for(const s of this.state.domStates)s.state===o.DocumentUnloaded&&s.when>t&&(e=s,t=s.when);return e}boot(){this.on("newState",e=>{this.addState(e)}),window.__bb_dom__load&&null!=window.__bb_dom__load&&"number"==typeof window.__bb_dom__load&&this.emit("newState",{state:o.DOMContentLoaded,when:window.__bb_dom__load,where:this.getCurrentPath()}),this.emit("newState",{state:o.DocumentLoaded,when:Date.now(),where:this.getCurrentPath()})}cleanup(){var e={state:o.DocumentUnloaded,when:Date.now(),where:this.getCurrentPath()};this.state.lastUnloadEvent=e,this.emit("newState",e)}formatSyncData(e){return e.domStates&&0!==e.domStates.length?(delete(e=(0,a.cloneObject)(this.state)).lastUnloadEvent,e):{_empty:!0}}onSync(e){e.response.success?this.state.domStates=this.eventBus.cleanSyncedData(this.state.domStates,e):this.byteboost.error("Unable to sync dom module")}build(){return{domStates:[],lastUnloadEvent:void 0}}}t.DOM=i},81:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorModule=void 0;var o=s(134);const r=s(675),n=s(580);class a extends o.BaseDataModule{screenshots;constructor(){super("errors"),this.priority={enabled:!0,priority:r.DATA_MODULE_UNLOAD_PRIORITY.ERRORS},this.garbageCollector.setOptimization({errors:{count:80}}),this.setSyncVariable("errors")}getEmptyTrackedError(){return{when:Date.now(),message:"",where:this.getCurrentPath()}}generateTrackedError(e){var t=this.getEmptyTrackedError();try{return e.message?"object"==typeof e.message||Array.isArray(e.message)?("message"in e.message&&"stack"in e.message?(t.message=e.message.message,t.stack=e.message.stack):t.message=e.message,"object"==typeof t.message&&("message"in t.message?t.message=t.message.message:"name"in t.message&&(t.message=t.message.name)),"string"!=typeof t.message&&(t.message="UNKNOWN ERROR")):t.message=e.message:t.message="UNKNOWN ERROR",t}catch(e){return t.message="UNKNOWN ERROR",t}}processError(e){e=this.generateTrackedError(e);this.screenshots.captureScreenshot(!0),this.emit("onError",e,r.EVENT_PRIORITY.ERRORS)}onGenericError(e){this.processError({message:e.error})}handledRejectionError(e){}unhandledRejectionError(e){this.processError({message:e.reason})}boot(){var e=this.byteboost.getModule("screenshots");if(!e)throw new Error("Unable to get screenshots module!");this.screenshots=e,window.addEventListener("rejectionhandled ",c),window.addEventListener("unhandledrejection",l),window.addEventListener("error",i),this.on("onError",e=>{this.addState(e)}),this.on("onErrorLog",e=>{})}cleanup(){window.removeEventListener("rejectionhandled ",c),window.removeEventListener("unhandledrejection",l)}formatSyncData(e){return e.errors&&0!==e.errors.length?(0,n.cloneObject)(this.state):{_empty:!0}}onSync(e){e.response.success?this.state.errors=this.eventBus.cleanSyncedData(this.state.errors,e):this.byteboost.error("Unable to sync error module")}build(){return{errors:[]}}}t.ErrorModule=a;const i=e=>{window._byteboost&&window._byteboost.getModule("errors")?.onGenericError(e)},c=e=>{window._byteboost&&window._byteboost.getModule("errors")?.handledRejectionError(e)},l=e=>{window._byteboost&&window._byteboost.getModule("errors")?.unhandledRejectionError(e)}},356:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventBus=t.ByteEvent=void 0;const o=s(580);var r=s(134);const n=s(397),a=s(601);var i=s(750);const c=s(762),l=s(810),h=e=>`${e}|${Date.now()}|`+(0,a.randomString)(8);class u{id;payload;eventId;_meta={dispatched:-1};delay;when;priority=0;constructor(e,t,s,o){e=(0,c.toByteId)(e,t);this.when=Date.now(),this.id=e,this.payload=s,this.eventId=h(e),this.delay={waited:0,toWait:0,lastPoll:0},o&&(this.priority=o)}isValid(){return!!(this.id&&this.payload&&this.delay&&this.eventId)}setPayload(e){this.payload=e}sharpen(e){return this.id=e.id,this.eventId=e.eventId,this.payload=e.payload,this.delay=e.delay,this._meta=e._meta,this.priority=e.priority,this.when=e.when,this}flatten(){return{id:this.id,payload:(0,o.cloneObject)(this.payload),delay:this.delay,_meta:this._meta,eventId:this.eventId,priority:this.priority,when:this.when}}wait(e){return this.delay.lastPoll=Date.now(),this.delay.toWait=e,this}copy(){return new u("","",{}).sharpen(this.flatten())}}t.ByteEvent=u;class d extends r.BaseModule{polling=!1;middlewares={before:[p,...i.beforeMiddlewares],after:[]};modulesToPoll=[];watcher;_garbage={events:[],eventsStr:[]};constructor(){super("eventBus"),this.watcher=new l.EventBusWatcher(this)}toByteId(e,t){return(0,c.toByteId)(e,t)}dispatch(e,t,s){this.dispatchEvent(new u(e,t,s))}dispatchEvent(e){try{if((0,n.isDev)()&&"object"==typeof e.payload&&!Array.isArray(e.payload)&&(0,a.findCircular)(e.payload))this.byteboost.error("unable to dispatch event. payload has circular properties -> new byte event:",e);else{const t=e.copy();Array.isArray(t.payload)?t.payload=t.payload.map(e=>(e.eventId=h(t.id),e)).filter(e=>null!=e):t.payload.eventId=t.eventId,this.state.eventQueue.push(t)}}catch(e){this.byteboost.error("Error on dispatch",e)}}listen(e,t,s){null!=this.state.eventListeners&&(e=(0,c.toByteId)(e,t),this.state.eventListeners.hasOwnProperty(e)?this.state.eventListeners[e].push(s):this.state.eventListeners[e]=[s])}getNextEvent(){return this.state.eventQueue[0]}removeNextEvent(){return this.state.eventQueue.shift()}before(e){let t=!0;for(var s of this.middlewares.before)if(!1===s(e)){t=!1;break}return t}addModulePolling(e){this.modulesToPoll.push(e)}enginePoll(){for(const e of this.modulesToPoll)e.onPoll();this.byteboost.onEventBusPoll()}after(t){t.id.startsWith("logger:")||Object.values(this._busHooks).forEach(e=>e(t))}async sleep(t){await new Promise(e=>{setTimeout(()=>{e()},t)})}_busHooks={};hookIntoBus(e){var t="event-bus-hook-"+(0,a.randomString)(8);return this._busHooks[t]=e,t}unhookFromBus(e){e in this._busHooks&&delete this._busHooks[e]}runEventContext(){let o=this.state.eventQueue.slice();const e=()=>{if(0===o.length)return null;let t=o[o.length-1],s=o.length-1;for(let e=0;e<o.length;e++)o[e].priority>t.priority&&(t=o[e],s=e);return o.splice(s,1),this.before(t)?t:e()};let t=e();var s;t&&(-1===(s=this.state.eventQueue.findIndex(e=>e.eventId===t.eventId))?this.byteboost.error("Unable to find event in event queue",t):(this.state.eventQueue.splice(s,1),this.state.processingEvents.push(t)))}dispatchNextProcessedEvent(){if(0===this.state.processingEvents.length)return null;var e,t=this.state.processingEvents[0];if(!(t.id in this.state.eventListeners)||0===this.state.eventListeners[t.id].length)return(0,n.isDev)()&&this.byteboost.warn("no listeners found for event:",t),null;this.byteboost.debug("dispatching event:",t);for(e of this.state.eventListeners[t.id])e(t.payload);return t._meta={dispatched:Date.now()},this.addHandledEvent(t),this.state.processingEvents.shift(),t}async poll(){var e;await this.sleep(this.watcher.getPollTime()),this.polling&&(this.watcher.onNewPoll(),null==this.state.eventListeners?(this.byteboost.error("[EventBus] No event listeners. Stopping polling"),this.polling=!1):(null!==(e=this.dispatchNextProcessedEvent())&&this.after(e),this.runEventContext(),this.enginePoll(),this.poll()))}declareGarbage(t,s){this._garbage.events.find(e=>t===e.app&&s===e.id)||(this._garbage.events.push({app:t,id:s}),this._garbage.eventsStr.push((0,c.toByteId)(t,s)))}removeHandledEvents(t){this.state.handledEvents=this.state.handledEvents.filter(e=>!t.includes(e.eventId))}getHandledEvent(t){if(t)return this.state.handledEvents.find(e=>e.eventId===t)}addHandledEvent(e){this.isGarbageEvent(e)||this.byteboost.minified||this.state.handledEvents.push(e.flatten())}cleanSyncedData(e,s){if(0===e.length)return e;let o=[];e=e.filter(e=>{var t,e=this.getHandledEvent(e.eventId);return!!e&&((t=!(e._meta.dispatched>s.data._syncRequestedAt))&&o.push(e.eventId),!t)});return this.removeHandledEvents(o),e}isGarbageEvent(e){return this._garbage.eventsStr.includes(e.id)}removeGarbageEvents(e){return e.filter(e=>{return!this._garbage.eventsStr.includes(e.id)})}packEventList(e){e=e.slice(),e=(0,a.removeCircular)((0,o.cloneObject)(e));return this.removeGarbageEvents(e)}unpackEventList(e){return e&&0!==e.length?e.map(e=>new u("","",{}).sharpen(e)):[]}boot(){this.polling=!0,this.declareGarbage("request","sync"),this.poll()}unpack(e){e.eventQueue=this.unpackEventList(e.eventQueue),e.processingEvents=this.unpackEventList(e.processingEvents),e.eventListeners={},super.unpack(e)}build(){return{eventQueue:[],processingEvents:[],eventListeners:{},lastEventId:"",handledEvents:[]}}async pack(){var e=this.packEventList(this.state.eventQueue),t=this.packEventList(this.state.processingEvents),s=this.state.handledEvents.slice(),s=(0,a.removeCircular)((0,o.cloneObject)(s));return{...this.state,eventListeners:null,eventQueue:e,processingEvents:t,handledEvents:s}}cleanup(){this.polling=!1,this.watcher.cleanup()}}t.EventBus=d;const p=e=>{if(!e.isValid()){var t=window._byteboost.getModule("eventBus");if(!t)return window._byteboost.error("Unable to find event bus module"),!1;t.byteboost.warn("Next event is invalid. Removing it",e),t.removeNextEvent()}return!0}},750:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.beforeMiddlewares=void 0;t.beforeMiddlewares=[e=>0===e.delay.toWait||(e.delay.waited=e.delay.waited+(Date.now()-e.delay.lastPoll),e.delay.lastPoll=Date.now(),e.delay.waited>e.delay.toWait)]},762:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toByteId=void 0;t.toByteId=(e,t)=>e+":"+t},810:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventBusWatcher=void 0;const o=s(782),r=s(978),n=s(601);t.EventBusWatcher=class{eventBus;timeout=-1;startTime=-1;cycle=0;cyclesTrackingInterval=o.WATCHER_CYCLES_BETWEEN_EVAL;utopiaInterval={cycles:-1,time:-1};constructor(e){this.eventBus=e;var e=r.localStorageInterface.getItem("bb_perf");let t=o.WATCHER_STARTING_TIMEOUT;e&&"number"==typeof(e=(0,n.tryParseNumber)(e))&&(t=e),window.addEventListener("focus",()=>{this.setTimeout(o.WATCHER_STARTING_TIMEOUT),this.cycle=0,this.startTime=-1}),this.setTimeout(t)}setTimeout(e){(e=e>o.WATCHER_MAX_TIMEOUT?o.WATCHER_MAX_TIMEOUT:e)<o.WATCHER_MIN_TIMEOUT&&(e=o.WATCHER_MIN_TIMEOUT),this.timeout=e,this.cyclesTrackingInterval=this.getCycleTrackingInterval(e),this.utopiaInterval.time=this.timeout*this.cyclesTrackingInterval,this.utopiaInterval.cycles=Math.floor(this.utopiaInterval.time/this.timeout)}getCycleTrackingInterval(e){return 2e3<e?1:1500<e?2:Math.floor(800/e+2)}evaluate(){var e;-1!==this.startTime&&((e=Date.now()-this.startTime-this.utopiaInterval.time)>=o.WATCHER_TIMEOUT_CHANGE_THRESHOLD?this.setTimeout(this.timeout+e/10):this.timeout>o.WATCHER_SLOW_TIMEOUT_THRESHOLD?this.setTimeout(this.timeout-o.WATCHER_SPEED_UP_STEP*o.WATCHER_SLOW_TIMEOUT_SPEEDUP_STEP_MULTIPLIER):this.setTimeout(this.timeout-o.WATCHER_SPEED_UP_STEP)),this.startTime=Date.now()}reset(){this.cycle=0,this.startTime=-1}onNewPoll(){this.cycle++,1e6<this.cycle?this.reset():this.cycle%this.cyclesTrackingInterval==0&&this.evaluate()}getPollTime(){return this.timeout}cleanup(){r.localStorageInterface.setItem("bb_perf",this.timeout.toString())}}},134:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseDataModule=t.BaseModule=void 0;const o=s(356),r=s(580),n=s(850),a=s(675),i=s(264);var c=s(154);const l=s(782);class h{state;namespace;isPolling=!1;isDataModule=!1;_eventBus;garbageCollector;obfuscateLevel=c.ObfuscateLevel.HIGH;constructor(e){this.namespace=e,this.garbageCollector=new i.GarbageCollector(this)}get byteboost(){return window._byteboost}bindEventBus(e){this._eventBus=e}get eventBus(){if("eventBus"===this.namespace)throw Error("Cannot access EventBus on EventBus");return this._eventBus}onEngineMetaData(){}onEngineInflated(){}onInitialSessionLoad(){}emit(e,t,s){this.eventBus.dispatchEvent(new o.ByteEvent(this.namespace,e,t,s))}on(e,t){this.eventBus.listen(this.namespace,e,t)}getCurrentPath(){return this.byteboost.getModule("navigations")?.getFormattedPath()??"UNKNOWN"}onPoll(){}receivePolls(){var e=this.byteboost.getModule("eventBus");if(!e)throw new Error("Unable to find the event bus module. unable to start module polling.");e.addModulePolling(this),this.isPolling=!0}onNewSettings(e){this.obfuscateLevel=e.obfuscateLevel}bootPreload(){this.garbageCollector.collect(),this.obfuscateLevel=this.byteboost.getObfuscateLevel(),"eventBus"!==this.namespace&&(this.eventBus.declareGarbage(this.namespace,"onSync"),this.eventBus.declareGarbage(this.namespace,"onSyncSkipped"))}cleanup(){}onBuildNeeded(){var e=this.build();this.state={updated:Date.now(),...e}}unpack(e){this.state=e,this.bindDefaultPersistantData(e)}bindDefaultPersistantData(e){this.state.updated=Date.now()}async pack(){return this.state}}t.BaseModule=h;t.BaseDataModule=class extends h{apiNamespace;didLastRequestSucceed=!1;failedSyncsInRow=0;isDataModule=!0;canSync=!0;syncVariable=null;lastStateArrayLength=-1;priority={enabled:!1};debounceTimeout=null;debouncedInSuccession=0;constructor(e){super(e),this.apiNamespace=this.namespace}bootPreload(){super.bootPreload(),this.eventBus.listen(this.namespace,"onSync",e=>{this.didLastRequestSucceed=e.response.success,e.response.success?0!==this.failedSyncsInRow&&(this.failedSyncsInRow=0):(this.failedSyncsInRow++,this.byteboost.debug("failed",this.failedSyncsInRow,"times in a row",this.namespace),this.failedSyncsInRow>=l.PURGE_STATE_AFTER_SYNC_FAILED_TIMES?(this.byteboost.debug("rebuilding",this.namespace,"because of sync fails"),this.failedSyncsInRow=0,this.onBuildNeeded()):this.sync(this.eventBus)),this.onSync(e)})}formatSyncData(e){return(0,r.cloneObject)(e)}baseFormatSyncData(e){var t=this.formatSyncData(this.state);return!0===t?._empty?null:{data:t,_syncRequestedAt:Date.now()}}setSyncVariable(e){this.syncVariable=e}addState(e){this.syncVariable&&(this.state[this.syncVariable].push(e),this.lastStateArrayLength=this.state[this.syncVariable].length+0,this.debounceSync())}sync(e,t){var s;this.canSync&&(s=this.baseFormatSyncData(e))&&e.dispatchEvent(new o.ByteEvent("request","sync",{path:n.BASE_API_URL+"/v1beta/events/"+(this.apiNamespace??this.namespace),event:new o.ByteEvent(this.namespace,"onSync",{},a.EVENT_PRIORITY.SYNC_REQUEST_CALLBACK).flatten(),data:s},a.EVENT_PRIORITY.SYNC_REQUEST))}stopSync(){this.canSync=!1}startSync(e){this.canSync=!0,this.doSync(e)}debounceSync(e){if(this.canSync)if(e)this.doSync(),this.debouncedInSuccession=0,this.debounceTimeout&&clearTimeout(this.debounceTimeout);else if(this.debouncedInSuccession>=l.MODULE_DEBOUNCES_UNTIL_FORCE_SYNC)this.debounceSync(!0);else{this.debouncedInSuccession++;const t=this.lastStateArrayLength+0,s=this;this.debounceTimeout=setTimeout(()=>{t===s.lastStateArrayLength&&s.debounceSync(!0)},l.MODULE_SYNC_DEBOUNCE_TIME)}}doSync(e){this.sync(this.eventBus,e)}forceSend(){if(this.canSync){var e=this.byteboost.getModule("eventBus");if(e){e=this.baseFormatSyncData(e);if(e){var t=this.byteboost.getModule("request");if(t)try{t.post(n.BASE_API_URL+"/v1beta/events/"+this.apiNamespace,e.data)}catch(e){}}}}}}},230:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=void 0;const o=s(601);var r=s(134);const n=s(580),a=s(675),i=s(154);class c extends r.BaseDataModule{logTrackingEnabled=!0;constructor(){super("logger"),this.apiNamespace="console",this.priority={enabled:!0,priority:a.DATA_MODULE_UNLOAD_PRIORITY.LOGGER},this.garbageCollector.setOptimization({logs:{count:350}}),this.setSyncVariable("logs")}cleanCircularStateObjects(){this.state.logs=(0,o.removeCircular)((0,n.cloneObject)(this.state)).logs}obfuscateLogDetail(e){return this.obfuscateLevel===i.ObfuscateLevel.MEDIUM?e.value=e.value.map(e=>{if("string"==typeof e)return"OBFUSCATED: "+(0,o.randomString)(e.length)}):this.obfuscateLevel===i.ObfuscateLevel.HIGH&&(e.value=e.value.map(e=>"string"==typeof e?"OBFUSCATED (STR): "+(0,o.randomString)(e.length):`OBFUSCATED (${typeof e})`)),e}async trackLog(e,...t){"string"==typeof t[0]&&t[0].includes("[byteboost]")||(t={value:t,when:Date.now(),kind:e.toLowerCase(),where:this.getCurrentPath()},this.emit("log",t,a.EVENT_PRIORITY.LOGGER))}boot(){const r=this;this.eventBus.listen("logger","log",e=>{e.kind===i.ConsoleType.ERROR&&this.eventBus.dispatch("errors","onErrorLog",e),this.addState(this.obfuscateLogDetail(e))});for(const e in console)"function"==typeof console[e]&&(console[e]=function(t,s,o){if(s)return function(...e){s.apply(t,Array.prototype.slice.apply(e)),r.logTrackingEnabled&&r.trackLog(o,...e)}}(console,console[e],e))}build(){return{logs:[]}}async pack(){return this.cleanCircularStateObjects(),this.state}cleanup(){this.logTrackingEnabled=!1}formatSyncData(e){var t;return e.logs&&0!==e.logs.length?((t={logs:[]}).logs=e.logs.map(e=>"clear"===e.kind?{...e,value:"CONSOLE_CLEAR"}:{...e,value:e.value.map(e=>{if("object"==typeof e)try{return JSON.stringify(e)}catch(e){}return e}).join("").replace(/\n/g,"[[{{NEW_LINE}}]]")}),t):{_empty:!0}}onSync(e){e.response.success?this.state.logs=this.eventBus.cleanSyncedData(this.state.logs,e):this.byteboost.error("Unable to sync logger module.")}}t.Logger=c},410:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Navigations=void 0;const n=s(782);var o=s(134);const a=s(580),r=s(675);class i extends o.BaseDataModule{lastScreenshotTime=1/0;constructor(){super("navigations"),this.priority={enabled:!0,priority:r.DATA_MODULE_UNLOAD_PRIORITY.NAVIGATIONS},this.garbageCollector.setOptimization({navigations:{count:200}}),this.setSyncVariable("navigations")}getCurrentUserPath(){return window.location.pathname}handlePath(){let t=this.getCurrentUserPath();if(0===t.length&&(t="/"),this.state.currentPath.pathname!==t){var s=Date.now(),o=(0,a.cloneObject)(this.state.currentPath),r=(this.state.currentPath.pathname=t,this.byteboost.debug("path changed!",this.state.currentPath),t.split("/")[0]),r=((r!==this.state.currentPath.basePath||Date.now()-n.MINIMUM_TIME_BETWEEN_SMALL_NAVIGATION_SCREENSHOTS<this.lastScreenshotTime)&&(this.lastScreenshotTime=Date.now(),this.byteboost.getModule("screenshots")?.captureScreenshot(!0)),this.byteboost.getModule("dom")?.getLatestUnloadState());let e=void 0;r&&s-r.when<n.NAVIGATION_UNLOAD_STATE_LIMIT&&(e=s-r.when),this.emit("pathUpdate",{from:o.pathname,to:this.state.currentPath.pathname,when:s,where:o.pathname,took:e})}}getFormattedPath(){return this.state.currentPath.pathname}onPoll(){this.handlePath()}onEngineInflated(){this.state.initialPath.hasSent||this.byteboost.getModule("request")&&(this.state.initialPath.hasSent=!0)}boot(){this.receivePolls(),this.on("pathUpdate",e=>{this.addState(e)})}formatSyncData(e){return e.navigations&&0!==e.navigations.length?(delete(e=(0,a.cloneObject)(e)).currentPath,delete e.initialPath,e):{_empty:!0}}onSync(e){e.response.success?this.state.navigations=this.eventBus.cleanSyncedData(this.state.navigations,e):this.byteboost.error("Unable to sync navigation module.")}build(){try{var e=this.getCurrentUserPath();return{navigations:[],currentPath:{pathname:e,basePath:e.split("/")[0]??""},initialPath:{hasSent:!1,path:e}}}catch(e){return{navigations:[],currentPath:{pathname:"/",basePath:""},initialPath:{hasSent:!1,path:"/"}}}}}t.Navigations=i},958:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PainpointTracker=void 0;var o=s(134);const l=s(601),h=s(825),u=s(762),d=s(978);class r extends o.BaseModule{painpoints={};hasReachedPainpoint=!1;eventsBeforePainpointsInit={};initialEventBusHookId="";constructor(){super("painpointTracker")}painpointReached(){this.hasReachedPainpoint||(this.hasReachedPainpoint=!0,this.byteboost.debug("painpoint reached, spinning up full engine"),this.byteboost.inflate())}onPainpointReached(e){var t=this.state.tracked[e];if(t){if(t.reached=!0,0===(this.state.tracked[e]=t).with.length)return this.painpointReached();for(const o of t.with){var s=Object.values(this.state.tracked).find(e=>e.id===o);if(!s||!1===s.reached)return}this.painpointReached()}}getTrackedId(e){return e}getTrackedComparisonId(e,t){return`${this.getTrackedId(e)}-${t.getter}-`+t.matcher}reachedComparisonPainpoint(e,t,s){t={getter:s.getter,matcher:s.matcher,kind:"comparison",reached:!0,with:t.with,id:t.id},e=this.getTrackedComparisonId(e,s);this.state.tracked[e]=t,this.onPainpointReached(e)}checkComparisonPainpoint(t,s,o){for(const a of s.comparisons){var r=a.getter.split(".");if(r[0]in o){var n=o[r[0]];if(!n)return void this.byteboost.error("Unable to get path",r[0]);let e=(0,l.tryParseNumber)(a.matcher);r=typeof(e=!1===e?a.matcher:e);if(r!=typeof n)return;if("number"==r){if(e>=n)return this.reachedComparisonPainpoint(t,s,a)}else if(e===n)return this.reachedComparisonPainpoint(t,s,a)}}}checkCountPainpoint(e,t,s){e=this.getTrackedId(e);let o=this.state.tracked[e];o?o.count++:o={count:1,kind:"count",with:t.with,reached:!1,id:t.id},(this.state.tracked[e]=o).count>=t.count&&this.onPainpointReached(e)}onEventDispatched(e,t){if(this.byteboost.minified&&!this.hasReachedPainpoint&&e in this.painpoints){var s=this.painpoints[e];if(Array.isArray(t))for(const o of t)switch(s.kind){case"count":this.checkCountPainpoint(e,s,o);break;case"comparison":this.checkComparisonPainpoint(e,s,o)}else switch(s.kind){case"count":this.checkCountPainpoint(e,s,t);break;case"comparison":this.checkComparisonPainpoint(e,s,t)}}}addEventBeforePainpointsInit(e){var t;null!=e.eventId&&((t=e.eventId.substring(0,e.eventId.indexOf("|")))in this.eventsBeforePainpointsInit?this.eventsBeforePainpointsInit[t].push(e):this.eventsBeforePainpointsInit[t]=[e])}onEvent(e){if(Array.isArray(e.payload))for(const t of e.payload)this.addEventBeforePainpointsInit(t);else this.addEventBeforePainpointsInit(e.payload)}async getPainpoints(){try{this.byteboost.debug("fetching painpoints");var s=d.localStorageInterface.getItem(d.PAINPOINT_JSON_KEY);let e=!0,t={};if("string"==typeof s)try{var o=JSON.parse((0,l.uncompressString)(s));t=o,e=!1}catch(e){}if(e){var r=await fetch(`${this.byteboost.isTest?"/api":"https://cdn.byteboost.io"}/v1beta/painpoints`,{headers:{Accept:"application/json","X-Auth-Token":window.byteboostKey}});if(!(0,h.isSuccessResponse)(r.status))throw new Error("Failed to fetch painpoints");t=await r.json()}if(this.byteboost.debug("got painpoints"),this.eventBus.unhookFromBus(this.initialEventBusHookId),e)try{d.localStorageInterface.setItem(d.PAINPOINT_JSON_KEY,(0,l.compressString)(JSON.stringify(t)))}catch(e){}for(const a of t){const i=(0,u.toByteId)(a.event.namespace,a.event.name);this.painpoints[i]=a;var n=this.eventsBeforePainpointsInit[i];if(null!=n)for(const c of n)this.onEventDispatched(i,c);this.eventBus.listen(a.event.namespace,a.event.name,e=>{this.onEventDispatched(i,e)})}this.eventsBeforePainpointsInit={}}catch(e){this.byteboost.error("Unable to fetch/unpack painpoints"),this.byteboost.purge()}}boot(){const t=this;this.initialEventBusHookId=this.eventBus.hookIntoBus(e=>t.onEvent(e))}build(){return{tracked:{}}}}t.PainpointTracker=r},886:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientPerformance=void 0;var o=s(134);const r=s(675),n=s(580);class a extends o.BaseDataModule{constructor(){super("performance"),this.apiNamespace="performances",this.priority={enabled:!0,priority:r.DATA_MODULE_UNLOAD_PRIORITY.PERFORMANCE},this.garbageCollector.setOptimization({performances:{count:450}}),this.setSyncVariable("performances")}pollCycleInterval=5;currentPollCycle=0;lastRate=null;onPoll(){var e;this.currentPollCycle++,this.currentPollCycle<this.pollCycleInterval||(this.currentPollCycle=0,(e=Math.round(this.eventBus.watcher.getPollTime()))!==this.lastRate&&(this.lastRate=e,this.pollCycleInterval=this.eventBus.watcher.cyclesTrackingInterval,this.emit("rate",{eventBusPollRate:e,when:Date.now(),where:this.getCurrentPath()})))}boot(){this.receivePolls(),this.on("rate",e=>{this.addState(e)})}cleanup(){}formatSyncData(e){return e.performances&&0!==e.performances.length?(0,n.cloneObject)(this.state):{_empty:!0}}onSync(e){e.response.success?this.state.performances=this.eventBus.cleanSyncedData(this.state.performances,e):this.byteboost.error("Unable to sync performance module")}build(){return{performances:[]}}}t.ClientPerformance=a},882:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pinger=void 0;const o=s(978);var r=s(134);const n=s(850),a=s(782);class i extends r.BaseModule{requestModule;lastPingTimestamp=0;constructor(){super("pinger")}async onPoll(){if(!this.byteboost.minified){var e=this.byteboost.syncInitializedAt;if(0!==e){e=(Date.now()-e)/1e3;if(!(e<a.PING_INTERVAL_IN_SECONDS)){if(0!==this.lastPingTimestamp)if((Date.now()-this.lastPingTimestamp)/1e3<a.PING_INTERVAL_IN_SECONDS)return;this.lastPingTimestamp=Date.now();e=await this.requestModule.get(n.BASE_API_URL+"/v1beta/session/ping");401===e.status&&(this.byteboost.cleanup(),o.localStorageInterface.purge()),this.byteboost.debug("DID PING",e)}}}}boot(){var e=this.byteboost.getModule("request");if(!e)throw new Error("Unable to get request module!");this.requestModule=e,this.receivePolls()}build(){return{}}}t.Pinger=i},258:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestModule=void 0;const i=s(782);var o=s(134);const r=s(356);class n extends o.BaseModule{persistantHeaders={};lastPostTimestamp=0;abortedRequestsInARow=0;constructor(){super("request")}isSuccessResponse(e){return 199<e&&e<300}handleStatusCode(e){401===e&&this.byteboost.kill()}async post(t,e){this.lastPostTimestamp=Date.now();try{const a=new AbortController;var s=a.signal,o=setTimeout(()=>{a.abort()},i.ABORT_SYNC_AFTER_MILLIS),r=await fetch(t,{credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json",...this.persistantHeaders},method:"POST",body:JSON.stringify(e),signal:s});clearTimeout(o),this.handleStatusCode(r.status),this.abortedRequestsInARow=0;try{var n=await r.json();return this.isSuccessResponse(r.status)?{status:r.status,body:n,success:!0}:{status:r.status,body:n,success:!1}}catch(e){if(this.isSuccessResponse(r.status))return{status:r.status,body:{},success:!0};try{this.byteboost.error("Unexpected post request error.")}catch(e){}return{status:r.status,body:r.body,success:!1}}}catch(e){try{"AbortError"===e.name&&(this.abortedRequestsInARow++,this.abortedRequestsInARow>=i.ABORT_COOLDOWN_AFTER_ATTEMPTS&&this.awaitAbort({path:t}),this.byteboost.error("Request timed out."))}catch(e){}try{this.byteboost.error("Unexpected post request error.")}catch(e){}return{status:500,body:{},success:!1}}}async get(e){var e=await fetch(e,{credentials:"include",headers:{...this.persistantHeaders,Accept:"application/json"}}),t=(this.handleStatusCode(e.status),await e.json());return this.isSuccessResponse(e.status)?{status:e.status,body:t,success:!0}:{status:e.status,body:t,success:!1}}awaitAbort({force:e,path:t}){t&&!this.state.abortCooldownForPaths.includes(t)&&this.state.abortCooldownForPaths.push(t),this.state.awaitingAbort&&!e||(this.byteboost.debug("has aborted, starting abort cooldown"),this.state.awaitingAbort=!0,setTimeout(()=>{this.state.awaitingAbort=!1;for(const e of this.state.syncQueue)this.handleSyncPayload(e);this.byteboost.debug("retried",this.state.syncQueue.length,"requests after abort cooldown"),this.state.syncQueue=[],this.state.abortCooldownForPaths=[]},i.ABORT_COOLDOWN_MILLIS))}addToSyncQueue(e){this.state.syncQueue.push(e)}async handleSyncPayload(e){var t,s;this.state.awaitingAbort&&this.state.abortCooldownForPaths.includes(e.path)?this.addToSyncQueue(e):(s=await this.post(e.path,e.data.data),t=new r.ByteEvent("","",{}).sharpen(e.event),s={response:s,responseTimestamp:Date.now(),data:e.data},t.setPayload(s),this.eventBus.dispatchEvent(t))}boot(){this.persistantHeaders={"X-Auth-Token":this.byteboost.getApiKey()},this.on("get",async e=>{var t=await this.get(e.path),e=new r.ByteEvent("","",{}).sharpen(e.event);e.setPayload(t),this.eventBus.dispatchEvent(e)}),this.on("sync",e=>{this.handleSyncPayload(e)}),this.state.awaitingAbort&&this.awaitAbort({force:!0})}build(){return{awaitingAbort:!1,syncQueue:[],abortCooldownForPaths:[]}}}t.RequestModule=n},798:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestErrors=void 0;const o=s(675);class r extends s(134).BaseDataModule{constructor(){super("requestErrors"),this.setSyncVariable("requestErrors"),this.priority={enabled:!0,priority:o.DATA_MODULE_UNLOAD_PRIORITY.REQUEST_ERRORS},this.garbageCollector.setOptimization({requestErrors:{count:80}})}boot(){this.on("onError",e=>{this.addState(e)})}build(){return{requestErrors:[]}}formatSyncData(e){return e.requestErrors&&0!==e.requestErrors.length?{requestErrors:e.requestErrors.slice()}:{_empty:!0}}onSync(e){e.response.success?this.state.requestErrors=this.eventBus.cleanSyncedData(this.state.requestErrors,e):this.byteboost.error("Unable to sync request errors module.")}}t.RequestErrors=r},592:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Screenshots=void 0;const a=s(782);var o=s(134);const n=s(601),r=s(765),i=s(675);class c extends o.BaseDataModule{screenshotWorker;lastScreenshotTime=-1;scrollState=[];lastMouseMovementTime=-1;constructor(){super("screenshots"),this.priority={enabled:!0,priority:i.DATA_MODULE_UNLOAD_PRIORITY.SCREENSHOTS},this.garbageCollector.setOptimization({screenshots:{count:150}}),this.setSyncVariable("screenshots")}getViewport(){return{width:window.innerWidth||window.outerWidth,height:window.innerHeight||window.outerHeight}}async captureScreenshot(e){try{var t=Date.now();if(!(!0===e&&t-a.MINIMUM_TIME_BETWEEN_FORCED_SCREENSHOTS<this.lastScreenshotTime)&&(e||!(t-a.MINIMUM_TIME_BETWEEN_SCREENSHOTS<this.lastScreenshotTime))){this.lastScreenshotTime=t,this.byteboost.debug("capturing screenshot");let e="";try{for(const r of Array.from(document.styleSheets))for(const n of Array.from(r.cssRules))e+=n.cssText}catch(e){}var s=(new XMLSerializer).serializeToString(document),o=new TextEncoder;this.screenshotWorker.emit("screenshot:parse",{document:o.encode(s),when:t,where:this.getCurrentPath(),obfuscateLevel:this.obfuscateLevel,viewport:this.getViewport(),scrollState:this.scrollState,cssRulesText:e})}}catch(e){try{this.byteboost.warn("Unable to process screenshot. Error: "+e?.toString())}catch(e){}}}onEngineMetaData(){this.byteboost.isInitialPageLoad&&this.captureScreenshot(!0)}onInitialSessionLoad(){const e=this;let t=setTimeout(()=>{e.captureScreenshot(!0)},500);document.addEventListener("load",()=>{clearInterval(t),e.captureScreenshot(!0)})}onScreenshotFromWorker(e){e={when:e.when,where:e.where,viewport:e.viewport,scrollState:e.scrollState,compressed:(0,n.compressString)((new TextDecoder).decode(e.document))};this.emit("screenshot:processed",e)}updateScrollState(e){try{let t=e.getAttribute("data-bb__ss__");var s,{scrollTop:o,scrollLeft:r}={scrollTop:parseInt(e.scrollTop+""),scrollLeft:parseInt(e.scrollLeft+"")};t?-1!==(s=this.scrollState.findIndex(e=>e.key===t))&&(this.scrollState[s].scrollTop=o,this.scrollState[s].scrollLeft=r,this.scrollState.push({key:t,scrollTop:o,scrollLeft:r})):(t=(0,n.randomString)(10),e.setAttribute("data-bb__ss__",t),this.scrollState.push({key:t,scrollTop:o,scrollLeft:r})),this.captureScreenshot()}catch(e){}}setupScroll(){document.addEventListener("scrollend",e=>{try{var t=(e=>{e=e.target;return e&&"scrollTop"in e&&void 0!==e.scrollTop&&null!==e.scrollTop?e:0===document.documentElement.scrollTop&&0===document.documentElement.scrollLeft?document.body:document.documentElement})(e);"getAttribute"in t&&this.updateScrollState(t)}catch(e){}},!0)}setupMouseMovement(){document.addEventListener("mousemove",()=>{-1===this.lastMouseMovementTime||Date.now()-this.lastMouseMovementTime>=a.CAPTURE_SCREENSHOW_ON_MOUSE_MOVE_DIFFERENCE&&this.captureScreenshot(),this.lastMouseMovementTime=Date.now()})}setupPageListeners(){document.addEventListener("DOMContentLoaded",()=>{this.captureScreenshot()},!0),document.addEventListener("keyup",e=>{"Escape"!==e.key&&"Enter"!==e.key&&" "!==e.key||this.captureScreenshot()},!0)}boot(){this.screenshotWorker=new r.WebWorker("screenshot-parser"),this.screenshotWorker.on("screenshot:parsed",e=>{this.byteboost.debug("got parsed screenshot",e),this.onScreenshotFromWorker(e)}),this.on("screenshot:processed",e=>{this.addState(e)}),this.eventBus.listen("navigations","pathUpdate",()=>{this.screenshotWorker.emit("clear:cache",{})}),this.setupScroll(),this.setupMouseMovement(),this.setupPageListeners()}build(){return{screenshots:[]}}cleanup(){this.screenshotWorker&&this.screenshotWorker.kill()}formatSyncData(e){return e.screenshots&&0!==e.screenshots.length?e:{_empty:!0}}onSync(e){e.response.success?this.state.screenshots=this.eventBus.cleanSyncedData(this.state.screenshots,e):this.byteboost.error("Unable to sync screenshots module.")}}t.Screenshots=c},872:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionRequests=void 0;var o=s(134);const r=s(675),n=s(765),a=s(924);class i extends o.BaseDataModule{networkTracker;obfuscationWorker;usingServiceWorker=!0;constructor(){super("session_requests"),this.apiNamespace="requests",this.setSyncVariable("requests"),this.priority={enabled:!0,priority:r.DATA_MODULE_UNLOAD_PRIORITY.SESSION_REQUESTS},this.garbageCollector.setOptimization({requests:{count:500}})}onPoll(){this.networkTracker.emit("requests:get"),this.obfuscationWorker.emit("requests:get",{})}handleRequests(e){for(const t of e)if("string"!=typeof t)if(!0===t.responseFailed){let e=t.reason??"NO_REASON";e.includes("?")&&(e=e.split("?")[0]),this.eventBus.dispatch("requestErrors","onError",{message:e,when:t.when,where:t.where??this.getCurrentPath(),referrer:t.referrer??"",url:t.url,requestHeaders:t.requestHeaders,method:t.method.toLowerCase()})}else t.referrer&&0!==t.referrer.length||(t.referrer=window.location.toString()),t.method=t.method.toLowerCase(),t.where&&0!==t.where.length||(t.where=this.getCurrentPath()),this.addState(t)}onNewSettings(e){this.obfuscateLevel=e.obfuscateLevel,this.obfuscationWorker.emit("obfuscate_level",this.obfuscateLevel)}fallbackFromServiceWorker(){this.byteboost.debug("falling back to fetch overrides"),this.usingServiceWorker=!1;const l=fetch;fetch=async(...s)=>{try{let e=s[0];if("string"!=typeof e){if("object"!=typeof e||Array.isArray(e))return l(...s);"url"in e&&(e=e.url)}if(e.includes("external.api.byteboost.io")||e.startsWith("chrome://")||e.startsWith("firefox://")||e.includes("cdn.byteboost.io")||this.byteboost.isTest&&(e.includes("/api/v1beta")||e.includes("/api/did")))return l(...s);var o=s[1],r=Date.now(),n={url:e,method:o?.method??"GET",requestHeaders:o?.headers??{},when:r,responseFailed:!1,where:this.getCurrentPath()};let t=null;try{t=await l(...s),n.took=Date.now()-r,n.ok=t.ok,n.redirected=t.redirected,n.status=t.status,n.statusText=t.statusText,n.type=t.type;var a,i,c={};for([a,i]of t.headers.entries())c[a]=i;n.responseHeaders=c}catch(e){n.responseFailed=!0;try{n.reason=e.toString()+". url: "+n.url}catch(e){n.reason="NO_REASON"}}return this.emit("on-overriden-fetch",n),null==t?l(...s):t}catch(e){return fetch(...s)}}}boot(){this.receivePolls();var t=(0,a.getPersistantWorker)("network-tracker"),e=new n.WebWorker("request-obfuscation");if(e&&(this.obfuscationWorker=e,this.obfuscationWorker.emit("obfuscate_level",this.obfuscateLevel),this.obfuscationWorker.on("requests:obfuscated",e=>{0!==e.length&&this.emit("requests",e)})),t){let e=!1;this.networkTracker=t,this.networkTracker.onFail(()=>{e=!0,this.fallbackFromServiceWorker()}),this.networkTracker.on("requests:get",e=>{0!==e.length&&this.obfuscationWorker.emit("requests:obfuscate",e)}),this.eventBus.listen("navigations","pathUpdate",()=>{e||this.networkTracker.emit("where",this.getCurrentPath())})}this.on("requests",e=>{this.handleRequests(e)}),this.on("on-overriden-fetch",e=>{this.obfuscationWorker.emit("requests:obfuscate",[e])})}build(){return{requests:[]}}formatSyncData(e){return e.requests&&0!==e.requests.length?{requests:e.requests.slice()}:{_empty:!0}}onSync(e){e.response.success?this.state.requests=this.eventBus.cleanSyncedData(this.state.requests,e):this.byteboost.error("Unable to sync session requests module.")}}t.SessionRequests=i},154:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConsoleType=t.ObfuscateLevel=void 0,t.ObfuscateLevel={HIGH:0,0:"HIGH",MEDIUM:1,1:"MEDIUM",LOW:2,2:"LOW"},t.ConsoleType={DEBUG:"debug",ERROR:"error",INFO:"info",LOG:"log",WARN:"warn",DIR:"dir",DIRXML:"dirxml",TABLE:"table",TRACE:"trace",GROUP:"group",GROUPCOLLAPSED:"groupCollapsed",GROUPEND:"groupEnd",CLEAR:"clear",COUNT:"count",COUNTRESET:"countReset",ASSERT:"assert",PROFILE:"profile",PROFILEEND:"profileEnd",TIME:"time",TIMELOG:"timeLog",TIMEEND:"timeEnd",TIMESTAMP:"timeStamp",CONTEXT:"context",CREATETASK:"createTask",MEMORY:"memory"}},252:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.preflightChecks=void 0;const u=s(782),d=s(978),p=s(555),b=s(154);t.preflightChecks=async()=>{try{if(void 0===window.performance||void 0===window.performance.now)return!1;try{window.performance.now()}catch(e){return!1}if(!0===window._startingByteboost)return!1;try{if(!("DOMParser"in window))return!1;if(!("TextEncoder"in window&&"TextDecoder"in window))return!1;if(!("XMLSerializer"in window))return!1;new XMLSerializer}catch(e){return!1}if(!window.byteboostKey){var r=document.querySelector("[data-byteboost-key]");if(!r)return!1;var n=r.getAttribute("data-byteboost-key");if(!n)return!1;window.byteboostKey=n}window._startingByteboost=!0;var a=-1;let e=!1,t=!1,s=!0;var i=d.localStorageInterface.getItem("_last_used_bb"),c=(i?(t=!0,a=parseInt(i),Date.now()-a>u.SESSION_INACTIVE_KILL_TIME?e=!0:s=!1):d.localStorageInterface.purge(),!e&&t||(d.localStorageInterface.removeItem(d.BYTEBOOST_SESSION_START_KEY),d.localStorageInterface.purge()),null==d.localStorageInterface.getItem(d.BYTEBOOST_SESSION_START_KEY)&&(d.localStorageInterface.setItem(d.BYTEBOOST_SESSION_START_KEY,Date.now().toString()),s=!0),"true"===d.localStorageInterface.getItem("bb_sess"));if(!c&&!(()=>{var s=[];for(let e=0;e<10;e++){var o=window.performance.now();let t=0;for(let e=0;e<1e6;e++)t+=(t*e+10*e)/(10*e);o=window.performance.now()-o;s.push(o)}let e=0;for(const t of s)e+=t;return!(125<(e/=s.length))})())return!1;let o=b.ObfuscateLevel.HIGH;try{var l,h=d.localStorageInterface.getItem(d.OBFUSCATE_LEVEL_KEY);"string"==typeof h&&(l=parseInt(h),(0,p.validateObfuscateLevel)(l))&&(o=l)}catch(e){}return{success:!0,isInitialPageLoad:s,obfuscateLevel:o,shouldInflate:c&&!e&&t}}catch(e){return!1}}},675:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_MODULE_UNLOAD_PRIORITY=t.UNLOAD_REQUEST_TIME_LIMIT_MS=t.EVENT_PRIORITY=void 0,t.EVENT_PRIORITY={LOGGER:-1,ERRORS:5,SYNC_REQUEST:100,SYNC_REQUEST_CALLBACK:95,ON_SYNC_SKIPPED:90},t.UNLOAD_REQUEST_TIME_LIMIT_MS=250,t.DATA_MODULE_UNLOAD_PRIORITY={ERRORS:20,REQUEST_ERRORS:19,SCREENSHOTS:18,CLICKS:17,NAVIGATIONS:16,SESSION_REQUESTS:15,DOM_STATES:14,LOGGER:13,PERFORMANCE:12}},429:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uncompressJSON=t.compressJSON=void 0;t.compressJSON=e=>{let r={},n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0,i=1;const c=e=>{var t,s=[];for(t of e)"object"!=typeof t?s.push(t):Array.isArray(t)?s.push(c(t)):s.push(l(t));return s},l=e=>{var t,s={};for(t in e){var o=(e=>{if(e in r)return r[e];let t="";if(a>=n.length&&(a=0,i++),1!==i)for(let e=0;e<i;e++)a+e>=n.length&&(a=0,i++),t+=n[a+e];else t=n[a];var s=`£${t}£`;return a++,r[e]=s})(t);"object"!=typeof e[t]?s[o]=e[t]:Array.isArray(e[t])?s[o]=c(e[t]):s[o]=l(e[t])}return s};var t,e=l(e),s={};for(t in r)s[r[t]]=t;return[e,s]};const n=(e,t)=>{var s,o=[];for(s of e)"object"!=typeof s?o.push(s):Array.isArray(s)?o.push(n(s,t)):o.push(a(s,t));return o},a=(e,t)=>{var s,o={};for(s in e){var r=t(s);"object"!=typeof e[s]?o[r]=e[s]:Array.isArray(e[s])?o[r]=n(e[s],t):o[r]=a(e[s],t)}return o};t.uncompressJSON=(e,t)=>{return a(e,e=>t[e])}},978:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.localStorageInterface=t.generateInspectorId=t.AWAITING_INFLATION_META_DATA_KEY=t.SYNCED_META_DATA_KEY=t.OBFUSCATE_LEVEL_KEY=t.PAINPOINT_JSON_KEY=t.PERSISTANT_DATA_KEY_MAPPING=t.PERSISTANT_DATA_KEY=t.BYTEBOOST_SESSION_START_KEY=void 0;const o=s(601),r=(t.BYTEBOOST_SESSION_START_KEY="__bb_st",t.PERSISTANT_DATA_KEY="__byteboost.io__persistant_data",t.PERSISTANT_DATA_KEY_MAPPING=t.PERSISTANT_DATA_KEY+"_m",t.PAINPOINT_JSON_KEY="_bb_pp_json",t.OBFUSCATE_LEVEL_KEY="_bb_obfs",t.SYNCED_META_DATA_KEY="_bb_meta",t.AWAITING_INFLATION_META_DATA_KEY="_bb_await_meta","__bb_id");t.generateInspectorId=()=>"_inspect_"+(0,o.randomString)(12),t.localStorageInterface={getInspectorId:function(){return this.getItem(r)},setInspectorId:function(e){this.setItem(r,e)},getItem:function(e){return localStorage.getItem(e)},setItem:function(e,t){localStorage.setItem(e,t)},removeItem:function(e){localStorage.removeItem(e)},purge:function(){localStorage.removeItem("bb_sess"),localStorage.removeItem("_last_used_bb"),localStorage.removeItem(t.BYTEBOOST_SESSION_START_KEY),localStorage.removeItem(r),localStorage.removeItem("bb_perf"),localStorage.removeItem(t.PAINPOINT_JSON_KEY),localStorage.removeItem(t.OBFUSCATE_LEVEL_KEY),localStorage.removeItem(t.SYNCED_META_DATA_KEY),localStorage.removeItem(t.AWAITING_INFLATION_META_DATA_KEY),this.purgeDataPoints()},purgeDataPoints:function(){localStorage.removeItem(t.PERSISTANT_DATA_KEY),localStorage.removeItem(t.PERSISTANT_DATA_KEY_MAPPING)}}},555:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateObfuscateLevel=void 0;t.validateObfuscateLevel=e=>!(!e||isNaN(e)||e<0||2<e)},580:(e,l,t)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),l.getAllObjKeys=l.cloneObject=void 0;const h=t(601);l.cloneObject=e=>{if(Array.isArray(e))return e.slice();if("object"!=typeof e)return e;let t=(0,h.removeCircular)(e),s={};const o=e=>"object"!=typeof e,r=e=>!!Array.isArray(e),n=e=>e.map(e=>o(e)?e:(r(e)?n:(0,l.cloneObject))(e));var a,i;for(a in t){var c=t[a];i=a,c=c,o(c)?s[i]=c:r(c)?s[i]=n(c):s[i]=(0,l.cloneObject)(t[i])}return s};l.getAllObjKeys=e=>{if(!e||"object"!=typeof e)return[];var t=[],s=[{obj:e,path:[]}];let o=0;for(;0<s.length;){if(500<++o)return!1;var{obj:r,path:n}=s.pop();if("object"==typeof r&&null!==r)for(const a in r)s.push({obj:r[a],path:[...n,a]});else t.push(n)}return t}},765:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebWorker=t.WorkerHandler=void 0;t.WorkerHandler=class{initialized=!1;filePath;workerState={ready:!1,upgrading:!1};currentWorker;workerRegistration;_subscriptions=new Map;_messageQueue=[];_hasFailed=!1;_failCb=null;constructor(e,t){if("undefined"==typeof window)throw new Error("Unable to initialize service worker on server");window._byteboost_workers||(window._byteboost_workers=new Map);var s=window._byteboost_workers.get(e);if(s)return s;this.filePath=t,window._byteboost_workers.set(e,this)}canCommunicate(){return this.workerState.ready&&!this.workerState.upgrading&&!this._hasFailed}on(e,t){this._subscriptions.set(e,t)}emit(e,t){this.currentWorker&&this.canCommunicate()?this.currentWorker.postMessage({id:e,payload:t}):this._messageQueue.push({id:e,payload:t})}onReady(){if(this.workerState.ready=!0,0!==this._messageQueue.length&&this.currentWorker&&this.canCommunicate())for(const e of this._messageQueue)this.emit(e.id,e.payload)}onWorkerMessage(e){var e=e.data,t=this._subscriptions.get(e.id);t&&t(e.payload)}registerWorker(e){this.currentWorker=e,navigator.serviceWorker.removeEventListener("message",e=>{this.onWorkerMessage(e)}),navigator.serviceWorker.addEventListener("message",e=>{this.onWorkerMessage(e)}),this.onReady()}kill(){this.workerRegistration&&this.workerRegistration.unregister()}onFail(e){this._hasFailed?e():this._failCb=e}failed(){this._hasFailed||(this._hasFailed=!0,this._failCb&&this._failCb())}init(){try{this.initialized||(this.initialized=!0,navigator&&"serviceWorker"in navigator?navigator.serviceWorker.register(this.filePath).then(e=>{(this.workerRegistration=e).active&&this.registerWorker(e.active),e.addEventListener("updatefound",()=>{this.workerState.upgrading=!0;const t=e.installing;t&&(t.onstatechange=e=>{"redundant"===t.state&&this.failed(),"activated"===t.state&&(this.workerState.upgrading=!1,this.workerState.ready=!1,this.registerWorker(t))})})}).catch(e=>{this.failed()}):this.failed())}catch(e){this.failed()}}};const s={"screenshot-parser":"https://cdn.byteboost.io/v1beta/repo/inspector/screenshot.js","request-obfuscation":"https://cdn.byteboost.io/v1beta/repo/inspector/requests_obfs.js"};t.WebWorker=class{name;filePath;worker;isActive=!1;_subscriptions=new Map;unsentMessages=[];constructor(e){this.name=e,this.filePath=s[e],this.start()}emit(e,t){this.isActive?this.worker.postMessage({id:e,payload:t}):this.unsentMessages.push({id:e,payload:t})}on(e,t){this._subscriptions.set(e,t)}kill(){this.worker&&this.worker.terminate()}start(){this.worker=new Worker(this.getWorkerUrl()),this.worker.onmessage=e=>{var t=e.data.id,e=e.data.payload;if("_self"===t&&"string"==typeof e&&"active"===e){if(this.isActive=!0,0!==this.unsentMessages.length){for(const s of this.unsentMessages)this.worker.postMessage(s);this.unsentMessages=[]}}else this._subscriptions.has(t)&&this._subscriptions.get(t)(e)}}getWorkerUrl(){var e=`importScripts( "${this.filePath}" );`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}}},923:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VersionManager=void 0;const o=s(978),r="__bb_ver_";t.VersionManager=class{byteboost;version="1.3.1";constructor(e){this.byteboost=e,this.handleVersion(),this.saveVersion()}saveVersion(){o.localStorageInterface.setItem(r,this.version)}handleVersion(){var e=o.localStorageInterface.getItem(r);e&&e===this.version||(this.byteboost.debug("migrating from version",e,"to",this.version),o.localStorageInterface.purgeDataPoints())}}},924:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPersistantWorker=t.killPersistantWorkers=t.setupPersistantWorkers=void 0;const o=s(765);t.setupPersistantWorkers=async()=>{new o.WorkerHandler("network-tracker","/byteboost.js").init()},t.killPersistantWorkers=async()=>{window._byteboost_workers.forEach(e=>{e.kill()})};t.getPersistantWorker=e=>window._byteboost_workers.get(e)}},r={};(function e(t){var s=r[t];return void 0===s&&(s=r[t]={exports:{}},o[t].call(s.exports,s,s.exports,e)),s.exports})(607)})();
