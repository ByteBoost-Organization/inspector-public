importScripts("https://cdn.byteboost.io/v1beta/repo/inspector/domparser.js");const BYTEBOOST_ELEMENT_ATTRIBUTES=["data-bb__ss__"];let toProcess=[];onmessage=e=>{var t=e.data.id,e=e.data.payload;"screenshot:parse"===t&&toProcess.push(e)},postMessage({id:"_self",payload:"active"});const recurseThroughElement=(t,a)=>{if(t&&"childNodes"in t&&t.childNodes){let e=Object.keys(t.childNodes);for(const o of e=e.slice(0,e.length-1)){var r=t.childNodes[o];t.childNodes[o]=parseElement(r,a),t.childNodes[o]=recurseThroughElement(r,a)}return t}},purgeElement=e=>{e.textContent="",e.innerHTML="",e.tagName="OBFUSCATED";let t=0;for(const a of getAttributes(e))e.removeAttribute(a.name),e.setAttribute("obfuscated_attr_"+t,"OBFUSCATED"),t++;return e},stripContent=e=>{e.textContent="",e.innerHTML=""},parseElement=(t,e)=>{if(null!=t.tagName){e=e.obfuscateLevel;if(0!==e&&!AllHTMLTags.includes(t.tagName))return purgeElement(t);if(!obfuscateOptions[e].allowedTags.includes(t.tagName))return purgeElement(t);var a=getAttributes(t).filter(e=>!BYTEBOOST_ELEMENT_ATTRIBUTES.includes(e));if(1===e)for(const r of a)t.setAttribute(r.name,"OBFUSCATED");else if(2===e){let e=0;for(const o of a)t.removeAttribute(o.name),t.setAttribute("obfuscated_attr_"+e,"OBFUSCATED"),e++;t.childNodes.length<=1&&(1!==t.childNodes.length||null==t.childNodes[key].tagName)&&stripContent(t)}}return t},getAttributes=a=>{if(!(a&&"attributes"in a))return[];let r=[];return Object.keys(a.attributes).forEach(e=>{var t=a.attributes[e];"object"==typeof t&&"_ownerDocument"!==e&&"nodeName"in t&&"nodeValue"in t&&null!=t.nodeValue&&r.push({name:t.nodeName,value:t.nodeValue})}),r},tagsWithText=(setInterval(()=>{if(0!==toProcess.length)try{var{document:e,when:t,where:a,obfuscateLevel:r,viewport:o,scrollState:s}=toProcess.shift(),i=(new TextDecoder).decode(e),l=(new xmldom.DOMParser).parseFromString(i,"text/html"),d=recurseThroughElement(l.documentElement,{obfuscateLevel:r}),n=(new xmldom.XMLSerializer).serializeToString(d);postMessage({id:"screenshot:parsed",payload:{document:(new TextEncoder).encode(n),when:t,where:a,viewport:o,scrollState:s}})}catch(e){}},200),["a","abbr","acronym","address","area","article","b","base","blockquote","button","caption","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","hr","i","img","ins","kbd","label","legend","li","link","map","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","s","samp","script","search","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","time","title","tr","tt","u","ul","var","wbr"]),obfuscateOptions={0:{allowedTags:["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"]},1:{allowedTags:["a","abbr","acronym","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"]},2:{allowedTags:["a","abbr","acronym","applet","area","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","canvas","caption","center","col","colgroup","data","datalist","dd","del","details","dfn","dir","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","param","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"]}},AllHTMLTags=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","big","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","small","source","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr"];
