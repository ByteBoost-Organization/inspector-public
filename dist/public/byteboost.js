self.addEventListener("install",()=>{self.skipWaiting()}),self.addEventListener("activate",e=>{e.waitUntil(clients.claim())});let allRequests=[],where="/";const isSuccessResponse=e=>199<e&&e<300,makeRequest=async d=>new Promise(async t=>{try{var s,r,a={};for([s,r]of d.request.headers.entries())a[s]=r;const u={method:d.request.method,referrer:d.request.referrer,url:d.request.url,when:Date.now(),requestHeaders:a,responseFailed:!1,where:where};if(u.url.includes("external.api.byteboost.io")||u.url.startsWith("chrome://")||u.url.startsWith("firefox://")||u.url.includes("cdn.byteboost.io"))return t(fetch(d.request));let e=null;try{var i,n,l=Date.now(),o=(e=await fetch(d.request),u.status=e.status,u.statusText=e.statusText,u.ok=e.ok,u.type=e.type,u.redirected=e.redirected,u.took=Date.now()-l,{});for([i,n]of e.headers.entries())o[i]=n;u.responseHeaders=o}catch(e){u.responseFailed=!0;try{u.reason=e.toString()}catch(e){u.reason="NO_REASON"}}null===e?t(fetch(d.request)):t(e),setTimeout(()=>{allRequests.push(u)},0)}catch(e){t(fetch(d.request))}});self.addEventListener("fetch",async e=>{e.respondWith(makeRequest(e))}),self.addEventListener("message",async e=>{var t=e.source.id;t&&(t=await clients.get(t))&&("where"===e.data.id?where=e.data.payload.where:"requests:get"===e.data.id&&(e=allRequests.slice(),allRequests=[],t.postMessage({id:"requests:get",payload:e})))});
