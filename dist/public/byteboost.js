self.addEventListener("install",()=>{self.skipWaiting()}),self.addEventListener("activate",e=>{e.waitUntil(clients.claim())});let allRequests=[],where="/";const isSuccessResponse=e=>199<e&&e<300,makeRequest=async d=>new Promise(async t=>{try{var s,r,a={};for([s,r]of d.request.headers.entries())a[s]=r;const o={method:d.request.method,referrer:d.request.referrer,url:d.request.url,when:Date.now(),requestHeaders:a,responseFailed:!1,where:where};if(o.url.includes("external.api.byteboost.io")||o.url.startsWith("chrome://")||o.url.startsWith("firefox://")||o.url.includes("cdn.byteboost.io"))return t(fetch(d.request));let e=null;try{var i,l,n=Date.now(),u=(e=await fetch(d.request),o.status=e.status,o.statusText=e.statusText,o.ok=e.ok,o.type=e.type,o.redirected=e.redirected,o.took=Date.now()-n,{});for([i,l]of e.headers.entries())u[i]=l;o.responseHeaders=u}catch(e){o.responseFailed=!0;try{o.reason=e.toString()+". url: "+o.url}catch(e){o.reason="NO_REASON"}}null===e?t(fetch(d.request)):t(e),setTimeout(()=>{allRequests.push(o)},0)}catch(e){t(fetch(d.request))}});self.addEventListener("fetch",async e=>{e.respondWith(makeRequest(e))}),self.addEventListener("message",async e=>{var t=e.source.id;t&&(t=await clients.get(t))&&("where"===e.data.id?where=e.data.payload.where:"requests:get"===e.data.id&&(e=allRequests.slice(),allRequests=[],t.postMessage({id:"requests:get",payload:e})))});
