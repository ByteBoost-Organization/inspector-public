"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ErrorModule=void 0;const _1=require("."),object_1=require("../utils/object");class ErrorModule extends _1.BaseDataModule{core;constructor(){super("errors")}processError(e){var r={when:Date.now(),message:"",where:this.core.getFormattedPath()};"message"in e.message&&"stack"in e.message?(r.message=e.message.message,r.stack=e.message.stack):r.message=e.message,this.core.captureScreenshot(!0),this.eventBus.dispatch(this.namespace,"onError",r)}handledRejectionError(e){console.log("got handled rejection error!")}unhandledRejectionError(e){console.log("catched error"),this.processError({message:e.reason})}boot(){var e=this.byteboost.getModule("core");if(!e)throw new Error("Unable to get core module!");this.core=e,window.addEventListener("rejectionhandled ",e=>{this.handledRejectionError(e)}),window.addEventListener("unhandledrejection",e=>{this.unhandledRejectionError(e)}),this.eventBus.listen(this.namespace,"onError",e=>{this.state.errors.push(e)}),this.doSync()}formatSyncData(){return 0===this.state.errors.length?{_empty:!0}:(0,object_1.cloneObject)(this.state)}onSync(e){e.response.success?this.state.errors=this.eventBus.cleanSyncedData(this.state.errors,e):this.byteboost.error("Unable to sync error module")}build(){return{errors:[]}}onOutsideError(){}}exports.ErrorModule=ErrorModule;
