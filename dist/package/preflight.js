"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.preflightChecks=void 0;const engine_1=require("./engine"),isSuccessResponse=e=>199<e&&e<300,preflightChecks=async()=>{if(void 0===window.performance||void 0===window.performance.now)return!1;try{window.performance.now()}catch(e){return!1}if(!0===window._startingByteboost)return console.log("already starting byteboost"),!1;if(!window.byteboostKey)return console.log("no api key"),!1;if(window._startingByteboost=!0,!checkBrowserPerformance())return!1;try{var o=window.performance.now(),t=await fetch(engine_1.BASE_API_URL+"/v1beta/session/",{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey}});if(console.log("fetched session with status",t.status),!isSuccessResponse(t.status))return console.log("unable to get session"),!1;var r,n=window.performance.now()-o;if(console.log("requestTook",n),650<n)return r=await fetch(engine_1.BASE_API_URL+"/v1beta/session/kill?networkPreflightFailed=true",{credentials:"include",headers:{"X-Auth-Token":window.byteboostKey}}),console.log("killed session with status",r.status),!1;var s=await t.text();let e=-1;try{if((e=parseInt(s))<0||2<e)throw"invalid level"}catch(e){return console.log("unable to parse obfuscate level",e),!1}return{success:!0,obfuscateLevel:e}}catch(e){return!1}},checkBrowserPerformance=(exports.preflightChecks=preflightChecks,()=>{var t=[];for(let e=0;e<10;e++){var r=window.performance.now();let o=0;for(let e=0;e<1e6;e++)o+=(o*e+10*e)/(10*e);r=window.performance.now()-r;t.push(r)}let e=0;for(const o of t)e+=o;return e/=t.length,console.log("performance result",e,"<",125),!(125<e)});
